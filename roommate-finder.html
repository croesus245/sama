<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roommate Finder - MWG Hostels</title>
    <link rel="icon" type="image/png" href="MWG logo@300x.png">
    <link rel="stylesheet" href="theme-system.css">
    <link rel="stylesheet" href="theme-integration.css">
    <link rel="stylesheet" href="universal-bg-system.css">
    <link rel="stylesheet" href="perfect-vibe-theme.css">
    <link rel="stylesheet" href="glass-morphism-global.css">
    <link rel="stylesheet" href="hostel-style.css">
    <link rel="stylesheet" href="advanced-styles.css">
    <link rel="stylesheet" href="modal-styles.css">
    <link rel="stylesheet" href="responsive-fixes.css">
    
    <!-- Environment Configuration -->
    <script src="env-config.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .roommate-hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: var(--space-4xl) 0;
            text-align: center;
        }

        .roommate-actions {
            display: flex;
            gap: var(--space-lg);
            justify-content: center;
            margin-top: var(--space-xl);
            flex-wrap: wrap;
        }
        
        .hero-action-icon {
            font-size: 2rem;
            color: #fff;
        }
        
        .hero-action-btn {
            background: rgba(255,255,255,0.2);
            border-color: white;
            color: white;
        }

        .action-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            text-align: center;
            min-width: 280px;
            transition: all var(--transition-base);
            cursor: pointer;
        }

        .action-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .action-card h3 {
            margin: var(--space-md) 0;
            font-size: var(--font-size-xl);
        }

        .action-card p {
            opacity: 0.9;
            margin-bottom: var(--space-lg);
        }

        .roommate-listings {
            padding: var(--space-4xl) 0;
        }

        .roommate-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: var(--space-xl);
            margin-top: var(--space-xl);
        }

        .roommate-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-base);
            border: 2px solid transparent;
        }

        .roommate-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-blue);
        }

        .roommate-header {
            background: var(--gradient-blue);
            color: white;
            padding: var(--space-lg);
            position: relative;
        }

        .roommate-status {
            position: absolute;
            top: var(--space-md);
            right: var(--space-md);
            background: var(--green);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: 600;
        }

        .roommate-status.found {
            background: var(--red);
        }

        .roommate-content {
            padding: var(--space-lg);
        }

        .room-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .session-badge {
            background: #10b981;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-block;
            margin: 0.5rem 0;
        }

        .contact-btn {
            width: 100%;
            background: var(--gradient-blue);
            color: white;
            border: none;
            padding: var(--space-md);
            border-radius: var(--radius-base);
            cursor: pointer;
            transition: all var(--transition-base);
            font-weight: 600;
            font-size: 1rem;
        }

        .contact-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .poster-info {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .gender-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }

        .simple-form {
            display: grid;
            gap: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .image-upload-area {
            border: 2px dashed var(--primary-blue);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            margin: 1rem 0;
            background: #f8fafc;
        }

        .image-upload-area:hover {
            background: #e2e8f0;
        }

        .image-preview {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .preview-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .roommate-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .action-card {
                min-width: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Dynamic Background System -->
    <div class="dynamic-background"></div>
    <div class="geometric-overlay"></div>
    <div class="floating-elements">
        <div class="floating-book"></div>
        <div class="floating-graduation"></div>
        <div class="floating-building"></div>
    </div>
    <div class="particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>
    
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="MWG logo@300x.png" alt="MWG Logo" class="logo" onerror="this.style.display='none'">
                <span class="brand-text">MWG Roommate Finder</span>
            </div>
            
            <div class="nav-menu">
                <a href="demo.html" class="nav-link">Home</a>
                <a href="#" class="nav-link">Browse Rooms</a>
                <a href="#" class="nav-link">My Posts</a>
                <a href="demo.html#hostels" class="nav-link">Hostels</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="roommate-hero">
        <div class="container">
            <h1>Find Your Session Roommate</h1>
            <p>Share rooms with fellow students for the current academic session</p>
            <small>Powered by MWG by SAMA d'GREAT platform</small>
            
            <div class="roommate-actions">
                <div class="action-card" onclick="showShareRoomModal()">
                    <i class="fas fa-share hero-action-icon"></i>
                    <h3>Share My Room</h3>
                    <p>Have a room and looking for someone to share with this session?</p>
                    <button class="btn btn-outline hero-action-btn">
                        Share Room
                    </button>
                </div>
                
                <div class="action-card" onclick="showFindRoomModal()">
                    <i class="fas fa-search hero-action-icon"></i>
                    <h3>Find Room to Share</h3>
                    <p>Looking for an available room to share this session?</p>
                    <button class="btn btn-outline hero-action-btn">
                        Find Room
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Room Sharing Listings -->
    <section class="roommate-listings">
        <div class="container">
            <div class="section-header text-center">
                <h2>Available Rooms to Share This Session</h2>
                <p>Find verified student room shares for the current academic session</p>
            </div>
            
            <div class="roommate-grid" id="roommateGrid">
                <!-- Sample Room Share Post -->
                <div class="roommate-card">
                    <div class="roommate-header">
                        <div class="roommate-status">Available</div>
                        <h3>Room Available for Sharing</h3>
                        <p><i class="fas fa-map-marker-alt"></i> FUTA South Gate</p>
                    </div>
                    
                    <div class="roommate-content">
                        <img src="https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=400&h=200&fit=crop" alt="Room to share" class="room-image">
                        
                        <div class="session-badge">
                            <i class="fas fa-calendar"></i> Current Session
                        </div>
                        
                        <div class="poster-info">
                            <p><strong>Shared by:</strong> John Doe</p>
                            <div class="gender-info">
                                <span><i class="fas fa-user"></i> Male</span>
                                <span><i class="fas fa-users"></i> Looking for Male roommate</span>
                            </div>
                        </div>
                        
                        <p>Clean, spacious room near campus. Good for serious students. Available immediately for session sharing.</p>
                        
                        <button class="contact-btn" onclick="contactForRoom('room1')">
                            <i class="fas fa-phone"></i> Contact to Share Room
                        </button>
                    </div>
                </div>
                
                <!-- Another sample post -->
                <div class="roommate-card">
                    <div class="roommate-header">
                        <div class="roommate-status found">Shared</div>
                        <h3>Room Share Completed</h3>
                        <p><i class="fas fa-map-marker-alt"></i> FUTA North Gate</p>
                    </div>
                    
                    <div class="roommate-content">
                        <img src="https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=200&fit=crop" alt="Shared room" class="room-image">
                        
                        <div class="session-badge" style="background: #6b7280;">
                            <i class="fas fa-check"></i> Room Shared
                        </div>
                        
                        <div class="poster-info">
                            <p><strong>Was shared by:</strong> Sarah Wilson</p>
                            <div class="gender-info">
                                <span><i class="fas fa-user"></i> Female</span>
                                <span><i class="fas fa-check"></i> Roommate found</span>
                            </div>
                        </div>
                        
                        <p>This room has been successfully shared for the current session. Both students are settled in.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Share Room Modal -->
    <div class="modal" id="shareRoomModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3><i class="fas fa-share"></i> Share Your Room This Session</h3>
                <button class="modal-close" onclick="closeShareRoomModal()">&times;</button>
            </div>
            
            <form class="simple-form" id="shareRoomForm">
                <div class="form-group">
                    <label for="posterName">Your Name *</label>
                    <input type="text" id="posterName" name="posterName" required placeholder="e.g., John Doe">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="posterGender">Your Gender *</label>
                        <select id="posterGender" name="posterGender" required>
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lookingForGender">Looking For *</label>
                        <select id="lookingForGender" name="lookingForGender" required>
                            <option value="">Select Preference</option>
                            <option value="male">Male Roommate</option>
                            <option value="female">Female Roommate</option>
                            <option value="any">No Preference</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="location">Location Near Campus *</label>
                    <select id="location" name="location" required>
                        <option value="">Select Gate Area</option>
                        <option value="north">North Gate Area</option>
                        <option value="south">South Gate Area</option>
                        <option value="west">West Gate Area</option>
                        <option value="other">Other Location</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="contactPhone">Your Phone Number *</label>
                    <input type="tel" id="contactPhone" name="contactPhone" required placeholder="+234 xxx xxx xxxx">
                </div>
                
                <div class="form-group">
                    <label for="whatsappNumber">WhatsApp Number (Optional)</label>
                    <input type="tel" id="whatsappNumber" name="whatsappNumber" placeholder="+234 xxx xxx xxxx">
                </div>
                
                <div class="form-group">
                    <label for="roomDescription">Brief Room Description *</label>
                    <textarea id="roomDescription" name="roomDescription" rows="3" required placeholder="Describe your room briefly - e.g., Clean, spacious room with good lighting, near campus..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="roomImages">Upload Room Images *</label>
                    <div class="image-upload-area">
                        <input type="file" id="roomImages" name="roomImages" multiple accept="image/*" style="display: none;">
                        <label for="roomImages" style="cursor: pointer;">
                            <i class="fas fa-camera" style="font-size: 2rem; color: var(--primary-blue); margin-bottom: 1rem;"></i>
                            <br>
                            <span style="font-weight: 600;">Click to upload room photos</span>
                            <br>
                            <small style="color: #666;">Upload 1-4 clear photos of your room</small>
                        </label>
                        <div class="image-preview" id="imagePreview"></div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeShareRoomModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-share"></i> Share Room for Session
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Contact Modal -->
    <div class="modal" id="contactModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-phone"></i> Contact for Room Sharing</h3>
                <button class="modal-close" onclick="closeContactModal()">&times;</button>
            </div>
            
            <form id="contactForm">
                <div class="form-group">
                    <label for="yourName">Your Name *</label>
                    <input type="text" id="yourName" name="yourName" required>
                </div>
                
                <div class="form-group">
                    <label for="yourPhone">Your Phone Number *</label>
                    <input type="tel" id="yourPhone" name="yourPhone" required>
                </div>
                
                <div class="form-group">
                    <label for="yourGender">Your Gender *</label>
                    <select id="yourGender" name="yourGender" required>
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="message">Message *</label>
                    <textarea id="message" name="message" rows="3" required placeholder="Hi! I saw your room sharing post on MWG platform. I'm interested in sharing the room for this session. Can we discuss?"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeContactModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> Send Message
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Simplified Room Sharing System - Session-based
        class SessionRoomSharing {
            constructor() {
                this.posts = [];
                this.init();
            }

            init() {
                this.loadSavedPosts();
                this.setupEventListeners();
                this.displayPosts();
            }

            loadSavedPosts() {
                const savedPosts = localStorage.getItem('sessionRoomPosts');
                this.posts = savedPosts ? JSON.parse(savedPosts) : [];
                console.log(`Loaded ${this.posts.length} session room sharing posts`);
            }

            savePosts() {
                localStorage.setItem('sessionRoomPosts', JSON.stringify(this.posts));
            }

            setupEventListeners() {
                // Share room form submission
                const shareRoomForm = document.getElementById('shareRoomForm');
                if (shareRoomForm) {
                    shareRoomForm.addEventListener('submit', (e) => this.handleShareRoomSubmission(e));
                }

                // Contact form submission
                const contactForm = document.getElementById('contactForm');
                if (contactForm) {
                    contactForm.addEventListener('submit', (e) => this.handleContactSubmission(e));
                }

                // Image upload handling
                const imageInput = document.getElementById('roomImages');
                if (imageInput) {
                    imageInput.addEventListener('change', (e) => this.handleImageUpload(e));
                }
            }

            handleShareRoomSubmission(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                
                // Validate required fields
                const requiredFields = ['posterName', 'posterGender', 'lookingForGender', 'location', 'contactPhone', 'roomDescription'];
                for (let field of requiredFields) {
                    if (!formData.get(field)) {
                        alert(`Please fill in the ${field.replace(/([A-Z])/g, ' $1').toLowerCase()}`);
                        return;
                    }
                }

                // Validate images
                const imageFiles = document.getElementById('roomImages').files;
                if (imageFiles.length === 0) {
                    alert('Please upload at least one room image');
                    return;
                }

                // Create new post
                const newPost = {
                    id: Date.now().toString(),
                    posterName: formData.get('posterName'),
                    posterGender: formData.get('posterGender'),
                    lookingForGender: formData.get('lookingForGender'),
                    location: formData.get('location'),
                    contactPhone: formData.get('contactPhone'),
                    whatsappNumber: formData.get('whatsappNumber') || formData.get('contactPhone'),
                    roomDescription: formData.get('roomDescription'),
                    images: this.processImages(imageFiles),
                    timestamp: new Date().toISOString(),
                    status: 'available'
                };

                // Add to posts array
                this.posts.push(newPost);
                this.savePosts();
                this.displayPosts();

                // Success feedback
                alert('Room sharing post created successfully! Your listing is now live for this session.');
                e.target.reset();
                this.clearImagePreview();
                closeShareRoomModal();
            }

            processImages(files) {
                const images = [];
                for (let i = 0; i < files.length && i < 4; i++) {
                    const file = files[i];
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        images.push(e.target.result);
                    };
                    reader.readAsDataURL(file);
                }
                return images;
            }

            handleImageUpload(e) {
                const files = e.target.files;
                const preview = document.getElementById('imagePreview');
                
                if (files.length > 4) {
                    alert('Please select maximum 4 images');
                    e.target.value = '';
                    return;
                }

                // Clear previous preview
                preview.innerHTML = '';

                // Show preview for each image
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = 'preview-image';
                            img.alt = `Room photo ${i + 1}`;
                            preview.appendChild(img);
                        };
                        reader.readAsDataURL(file);
                    }
                }

                // Update label text
                const label = document.querySelector('label[for="roomImages"] span');
                if (label) {
                    label.textContent = `${files.length} image(s) selected`;
                }
            }

            clearImagePreview() {
                const preview = document.getElementById('imagePreview');
                if (preview) {
                    preview.innerHTML = '';
                }
                const label = document.querySelector('label[for="roomImages"] span');
                if (label) {
                    label.textContent = 'Click to upload room photos';
                }
            }

            handleContactSubmission(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const contactData = {
                    yourName: formData.get('yourName'),
                    yourPhone: formData.get('yourPhone'),
                    yourGender: formData.get('yourGender'),
                    message: formData.get('message'),
                    timestamp: new Date().toISOString()
                };

                // Validate required fields
                if (!contactData.yourName || !contactData.yourPhone || !contactData.yourGender || !contactData.message) {
                    alert('Please fill in all required fields.');
                    return;
                }

                console.log('Contact message for room sharing:', contactData);
                alert('Message sent successfully! The room owner will contact you soon via phone or WhatsApp.');
                e.target.reset();
                closeContactModal();
            }

            displayPosts() {
                const roommateGrid = document.getElementById('roommateGrid');
                if (!roommateGrid) return;

                // Clear existing user-generated posts (keep sample posts)
                const userPosts = roommateGrid.querySelectorAll('.user-post');
                userPosts.forEach(post => post.remove());

                // Add new posts
                this.posts.forEach((post, index) => {
                    const postCard = this.createRoomCard(post, index);
                    roommateGrid.appendChild(postCard);
                });
            }

            createRoomCard(post, index) {
                const card = document.createElement('div');
                card.className = 'roommate-card user-post';
                
                const locationName = this.getLocationName(post.location);
                const genderPreference = this.getGenderPreference(post.lookingForGender);
                
                card.innerHTML = `
                    <div class="roommate-header">
                        <div class="roommate-status">${post.status === 'available' ? 'Available' : 'Shared'}</div>
                        <h3>Room Available for Sharing</h3>
                        <p><i class="fas fa-map-marker-alt"></i> ${locationName}</p>
                    </div>
                    
                    <div class="roommate-content">
                        ${post.images && post.images.length > 0 ? `
                            <img src="${post.images[0]}" alt="Room to share" class="room-image">
                        ` : `
                            <img src="https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=400&h=200&fit=crop" alt="Room placeholder" class="room-image">
                        `}
                        
                        <div class="session-badge">
                            <i class="fas fa-calendar"></i> Current Session
                        </div>
                        
                        <div class="poster-info">
                            <p><strong>Shared by:</strong> ${post.posterName}</p>
                            <div class="gender-info">
                                <span><i class="fas fa-user"></i> ${post.posterGender}</span>
                                <span><i class="fas fa-users"></i> ${genderPreference}</span>
                            </div>
                        </div>
                        
                        <p>${post.roomDescription}</p>
                        
                        <div style="margin: 1rem 0; padding: 0.5rem; background: #f1f5f9; border-radius: 8px; font-size: 0.9rem;">
                            <i class="fas fa-clock"></i> Posted ${new Date(post.timestamp).toLocaleDateString()}
                        </div>
                        
                        ${post.status === 'available' ? `
                            <button class="contact-btn" onclick="sessionRoomSharing.contactForRoom('${index}')">
                                <i class="fas fa-phone"></i> Contact to Share Room
                            </button>
                        ` : `
                            <div style="text-align: center; padding: 1rem; background: #f3f4f6; border-radius: 8px; color: #6b7280;">
                                <i class="fas fa-check-circle"></i> Room has been shared
                            </div>
                        `}
                    </div>
                `;
                return card;
            }

            getLocationName(location) {
                const locations = {
                    'north': 'FUTA North Gate Area',
                    'south': 'FUTA South Gate Area',
                    'west': 'FUTA West Gate Area',
                    'other': 'Other Campus Area'
                };
                return locations[location] || location;
            }

            getGenderPreference(preference) {
                const preferences = {
                    'male': 'Looking for Male roommate',
                    'female': 'Looking for Female roommate',
                    'any': 'No gender preference'
                };
                return preferences[preference] || preference;
            }

            contactForRoom(postIndex) {
                const post = this.posts[postIndex];
                if (!post) return;

                // Pre-fill contact form
                const messageField = document.getElementById('message');
                if (messageField) {
                    messageField.value = `Hi ${post.posterName}! I saw your room sharing post on MWG platform. I'm a ${post.lookingForGender === 'any' ? '' : post.lookingForGender} student interested in sharing your room for this session. Can we discuss the details?`;
                }

                showContactModal();
            }

            markRoomAsShared(postIndex) {
                if (confirm('Mark this room as shared? This will close the post.')) {
                    this.posts[postIndex].status = 'shared';
                    this.savePosts();
                    this.displayPosts();
                    alert('Room marked as shared! The post has been updated.');
                }
            }
        }

        // Modal functions
        function showShareRoomModal() {
            const modal = document.getElementById('shareRoomModal');
            if (modal) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }

        function closeShareRoomModal() {
            const modal = document.getElementById('shareRoomModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        function showFindRoomModal() {
            alert('Find Room to Share - Browse through available room sharing posts above! Use the contact buttons to reach out to room owners.');
        }

        function showContactModal() {
            const modal = document.getElementById('contactModal');
            if (modal) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }

        function closeContactModal() {
            const modal = document.getElementById('contactModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        function contactForRoom(roomId) {
            const messageField = document.getElementById('message');
            if (messageField) {
                messageField.value = "Hi! I saw your room sharing post on MWG platform. I'm interested in sharing the room for this session. Can we discuss?";
            }
            showContactModal();
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                if (event.target.id === 'shareRoomModal') {
                    closeShareRoomModal();
                } else if (event.target.id === 'contactModal') {
                    closeContactModal();
                }
            }
        });

        // Initialize the system
        let sessionRoomSharing;
        document.addEventListener('DOMContentLoaded', function() {
            sessionRoomSharing = new SessionRoomSharing();
            console.log('✅ Session Room Sharing System Loaded');
        });
    </script>
    
    <!-- Load error handler -->
    <script src="fixed-error-handler.js"></script>
    
    <!-- Theme System -->
    <script src="theme-toggle.js"></script>
    
    <!-- Advanced Features -->
    <script src="environment-config.js"></script>
    <script src="advanced-features.js"></script>
</body>
</html>
        // Modal functions
        function showPostRoomModal() {
            document.getElementById('postRoomModal').style.display = 'flex';
        }

        function closePostRoomModal() {
            document.getElementById('postRoomModal').style.display = 'none';
        }

        function showFindRoommateModal() {
            alert('Find Roommate feature - browse through available posts above!');
        }

        function contactRoommate(roomId) {
            // Pre-fill the message with platform attribution
            const messageField = document.getElementById('message');
            messageField.value = "Hi! I saw your roommate post on the MWG by SAMA d'GREAT platform. I'm interested in sharing the room. Can we discuss?";
            document.getElementById('contactModal').style.display = 'flex';
        }

        function closeContactModal() {
            document.getElementById('contactModal').style.display = 'none';
        }

        function markAsFound(roomId) {
            if (confirm('Mark this room as "Roommate Found"? This will close the post and notify interested parties.')) {
                // Update the UI
                const card = event.target.closest('.roommate-card');
                const status = card.querySelector('.roommate-status');
                status.textContent = 'Found';
                status.classList.add('found');
                
                // Hide the "Found" button
                event.target.style.display = 'none';
                
                // Add completion message
                const content = card.querySelector('.roommate-content p:last-of-type');
                content.innerHTML += ' <em>Roommate found - post closed.</em>';
                
                alert('Room marked as "Roommate Found"! The post has been closed and interested parties will be notified.');
            }
        }

        // Form submissions with enhanced validation
        document.getElementById('postRoomForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            const formData = new FormData(form);
            
            // Validate required fields
            const requiredFields = ['roomTitle', 'location', 'rent', 'rentPeriod', 'posterGender', 'roommateGender', 'fullAddress', 'description'];
            for (let field of requiredFields) {
                if (!formData.get(field)) {
                    alert(`Please fill in the ${field.replace(/([A-Z])/g, ' $1').toLowerCase()}`);
                    return;
                }
            }
            
            // Collect amenities including "other" option
            const amenities = [];
            const amenityCheckboxes = form.querySelectorAll('input[name="amenities"]:checked');
            amenityCheckboxes.forEach(checkbox => {
                if (checkbox.value === 'other') {
                    // Get the "other" amenity text
                    const otherAmenityInput = form.querySelector('input[name="otherAmenity"]');
                    if (otherAmenityInput && otherAmenityInput.value.trim()) {
                        amenities.push(otherAmenityInput.value.trim());
                    }
                } else {
                    amenities.push(checkbox.value);
                }
            });
            
            const roomData = {
                roomTitle: formData.get('roomTitle'),
                location: formData.get('location'),
                rent: formData.get('rent'),
                rentPeriod: formData.get('rentPeriod'),
                posterGender: formData.get('posterGender'),
                roommateGender: formData.get('roommateGender'),
                fullAddress: formData.get('fullAddress'),
                description: formData.get('description'),
                amenities: amenities,
                timestamp: new Date().toISOString()
            };
            
            console.log('Room data with amenities:', roomData);
            
            // Store in localStorage for demo
            const existingPosts = JSON.parse(localStorage.getItem('roommatePosts') || '[]');
            existingPosts.push(roomData);
            localStorage.setItem('roommatePosts', JSON.stringify(existingPosts));
            
            alert('Room posted successfully! Your listing will appear after verification.');
            form.reset();
            closePostRoomModal();
            
            // Refresh the display
            displayRoommatePosts(existingPosts);
        });

        document.getElementById('contactForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const contactData = {
                senderName: formData.get('senderName'),
                senderPhone: formData.get('senderPhone'),
                message: formData.get('message'),
                timestamp: new Date().toISOString()
            };
            
            // Validate required fields
            if (!contactData.senderName || !contactData.senderPhone || !contactData.message) {
                alert('Please fill in all required fields.');
                return;
            }
            
            console.log('Contact message:', contactData);
            alert('Message sent successfully! The room owner will contact you soon via phone or WhatsApp.');
            e.target.reset();
            closeContactModal();
        });

        // File upload previews with enhanced handling
        document.getElementById('roomPhotos').addEventListener('change', function(e) {
            const files = e.target.files;
            console.log(`${files.length} photos selected for upload`);
            
            if (files.length > 6) {
                alert('Please select a maximum of 6 photos');
                e.target.value = '';
                return;
            }
            
            // Show preview count
            const label = document.querySelector('label[for="roomPhotos"] span');
            if (label && files.length > 0) {
                label.textContent = `${files.length} photos selected`;
            }
        });

        document.getElementById('roomVideos').addEventListener('change', function(e) {
            const files = e.target.files;
            console.log(`${files.length} videos selected for upload`);
            
            if (files.length > 2) {
                alert('Please select a maximum of 2 videos');
                e.target.value = '';
                return;
            }
            
            // Check file sizes
            let totalSize = 0;
            for (let file of files) {
                totalSize += file.size;
                if (file.size > 25 * 1024 * 1024) { // 25MB
                    alert('Each video must be under 25MB');
                    e.target.value = '';
                    return;
                }
            }
            
            // Show preview count
            const label = document.querySelector('label[for="roomVideos"] span');
            if (label && files.length > 0) {
                label.textContent = `${files.length} videos selected (${Math.round(totalSize / 1024 / 1024)}MB)`;
            }
        });
        
        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                if (event.target.id === 'postRoomModal') {
                    closePostRoomModal();
                } else if (event.target.id === 'contactModal') {
                    closeContactModal();
                }
            }
        });
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Roommate Finder page loaded');
            
            // Load any saved roommate posts
            const savedPosts = JSON.parse(localStorage.getItem('roommatePosts') || '[]');
            console.log(`${savedPosts.length} saved roommate posts found`);
            
            // Display the saved posts
            displayRoommatePosts(savedPosts);
        });
        
        // Function to display roommate posts
        function displayRoommatePosts(posts) {
            const roommateGrid = document.getElementById('roommateGrid');
            if (!roommateGrid) return;
            
            // Clear existing content except for any sample posts
            const existingCards = roommateGrid.querySelectorAll('.roommate-card');
            
            // Add new posts
            posts.forEach((post, index) => {
                const postCard = createRoommateCard(post, index);
                roommateGrid.appendChild(postCard);
            });
        }
        
        // Function to create a roommate card
        function createRoommateCard(post, index) {
            const card = document.createElement('div');
            card.className = 'roommate-card';
            card.innerHTML = `
                <div class="roommate-header">
                    <div class="roommate-status">Looking</div>
                    <h3>${post.roomTitle}</h3>
                    <p><i class="fas fa-map-marker-alt"></i> FUTA ${post.location.charAt(0).toUpperCase() + post.location.slice(1)} Gate</p>
                </div>
                
                <div class="roommate-content">
                    <div class="rent-info">
                        <span class="rent-amount">₦${parseInt(post.rent).toLocaleString()}</span>
                        <span class="rent-period">per ${post.rentPeriod}</span>
                    </div>
                    
                    <div class="gender-preference">
                        <span><strong>Poster:</strong> ${post.posterGender}</span>
                        <span><strong>Looking for:</strong> ${post.roommateGender}</span>
                    </div>
                    
                    <div class="description">
                        <p>${post.description}</p>
                    </div>
                    
                    <div class="amenities">
                        <strong>Amenities:</strong>
                        ${post.amenities.map(amenity => `<span class="amenity-tag">${amenity}</span>`).join('')}
                    </div>
                    
                    <div class="contact-info">
                        <p><i class="fas fa-map-marker-alt"></i> ${post.fullAddress}</p>
                        <small><i class="fas fa-clock"></i> Posted ${new Date(post.timestamp).toLocaleDateString()}</small>
                    </div>
                </div>
                
                <div class="roommate-actions">
                    <button class="btn btn-primary" onclick="contactRoommate('${index}')">
                        <i class="fas fa-comment"></i> Contact
                    </button>
                    <button class="btn btn-success hidden-found-btn" onclick="markAsFound('${index}')">
                        <i class="fas fa-check"></i> Found
                    </button>
                </div>
            `;
            return card;
        }
        
        // Toggle other amenity field for roommate
        function toggleOtherAmenityRoommate() {
            const checkbox = document.getElementById('otherAmenityCheckRoommate');
            const otherGroup = document.getElementById('otherAmenityGroupRoommate');
            const otherInput = document.getElementById('otherAmenityRoommate');
            
            if (checkbox && otherGroup && otherInput) {
                if (checkbox.checked) {
                    otherGroup.classList.add('show');
                    otherInput.focus();
                } else {
                    otherGroup.classList.remove('show');
                    otherInput.value = '';
                }
            }
        }
        
        // Enhanced modal functions
        function showPostRoomModal() {
            const modal = document.getElementById('postRoomModal');
            if (modal) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }

        function closePostRoomModal() {
            const modal = document.getElementById('postRoomModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        function showFindRoommateModal() {
            alert('Find Roommate feature - browse through available posts above! Use the contact buttons to reach out to room posters.');
        }

        function contactRoommate(roomId) {
            // Pre-fill the message with platform attribution
            const messageField = document.getElementById('message');
            if (messageField) {
                messageField.value = "Hi! I saw your roommate post on the MWG by SAMA d'GREAT platform. I'm interested in sharing the room. Can we discuss the details?";
            }
            
            const modal = document.getElementById('contactModal');
            if (modal) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }

        function closeContactModal() {
            const modal = document.getElementById('contactModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        function markAsFound(roomId) {
            if (confirm('Mark this room as "Roommate Found"? This will close the post and notify interested parties.')) {
                // Update the UI
                const card = event.target.closest('.roommate-card');
                if (card) {
                    const status = card.querySelector('.roommate-status');
                    if (status) {
                        status.textContent = 'Found';
                        status.classList.add('found');
                    }
                    
                    // Hide the "Found" button
                    if (event.target) {
                        event.target.style.display = 'none';
                    }
                    
                    // Add completion message
                    const content = card.querySelector('.roommate-content p:last-of-type');
                    if (content) {
                        content.innerHTML += ' <em>Roommate found - post closed.</em>';
                    }
                }
                
                alert('Room marked as "Roommate Found"! The post has been closed and interested parties will be notified.');
            }
        }
    </script>
    
    <style>
        /* Other Amenity Styles */
        .amenities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 8px;
            transition: background 0.3s ease;
        }
        
        .checkbox-item:hover {
            background: var(--gray-50);
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        .other-amenity-group {
            display: none;
            margin-top: 1rem;
        }
        
        .other-amenity-group.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .file-upload-area {
            border: 2px dashed var(--border-primary);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            margin-top: 0.5rem;
        }
        
        .file-upload-area:hover {
            border-color: var(--primary-blue);
            background: var(--gray-50);
        }
        
        .file-upload-label {
            cursor: pointer;
            display: block;
        }
        
        .file-upload-label i {
            font-size: 2rem;
            color: var(--primary-blue);
            margin-bottom: 1rem;
        }
        
        .file-upload-label span {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .file-upload-label small {
            color: var(--text-secondary);
        }
    </style>
    
    <!-- Theme System -->
    <script src="form-enhancements.js"></script>
    <script src="theme-toggle.js"></script>
    
    <!-- Advanced Features -->
    <script src="environment-config.js"></script>
    <script src="advanced-features.js"></script>
</body>
</html>