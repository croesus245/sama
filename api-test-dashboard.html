<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test Dashboard - MWG Hostels</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
        }
        
        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .hostel-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        
        .hostel-card h3 {
            color: #333;
            margin-bottom: 8px;
        }
        
        .hostel-card p {
            color: #666;
            margin: 4px 0;
        }
        
        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin-top: 10px;
        }
        
        .endpoint {
            font-family: monospace;
            background: #f4f4f4;
            padding: 4px 8px;
            border-radius: 4px;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ MWG Hostels API Test Dashboard</h1>
        <p class="subtitle">Test your MongoDB backend API endpoints</p>
        
        <div id="serverStatus" class="status info">
            üîÑ Checking server status...
        </div>
        
        <!-- Test 1: Health Check -->
        <div class="test-section">
            <h2>1Ô∏è‚É£ Health Check</h2>
            <p>Test endpoint: <span class="endpoint">GET /api/health</span></p>
            <button onclick="testHealth()">Run Health Check</button>
            <div id="healthResult"></div>
        </div>
        
        <!-- Test 2: Get All Hostels -->
        <div class="test-section">
            <h2>2Ô∏è‚É£ Get All Hostels</h2>
            <p>Test endpoint: <span class="endpoint">GET /api/hostels</span></p>
            <button onclick="getAllHostels()">Get All Hostels</button>
            <div id="hostelsResult"></div>
        </div>
        
        <!-- Test 3: Create New Hostel -->
        <div class="test-section">
            <h2>3Ô∏è‚É£ Create New Hostel</h2>
            <p>Test endpoint: <span class="endpoint">POST /api/hostels</span></p>
            <button onclick="createHostel()">Create Test Hostel</button>
            <div id="createResult"></div>
        </div>
        
        <!-- Test 4: Get Realtor Hostels -->
        <div class="test-section">
            <h2>4Ô∏è‚É£ Get Realtor's Hostels</h2>
            <p>Test endpoint: <span class="endpoint">GET /api/hostels/realtor/:id</span></p>
            <input type="text" id="realtorId" placeholder="Enter Realtor ID (e.g., test-realtor-001)" style="width: 300px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; margin-right: 10px;">
            <button onclick="getRealtorHostels()">Get Realtor's Hostels</button>
            <div id="realtorResult"></div>
        </div>
        
        <!-- Run All Tests -->
        <div class="test-section" style="background: #f0f7ff;">
            <h2>üöÄ Run All Tests</h2>
            <button onclick="runAllTests()" style="background: #28a745;">Run Complete Test Suite</button>
            <div id="allTestsResult"></div>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://localhost:5000/api';
        
        // Check server status on load
        window.onload = async () => {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                document.getElementById('serverStatus').className = 'status success';
                document.getElementById('serverStatus').innerHTML = `‚úÖ Server is running! Database: ${data.database}`;
            } catch (error) {
                document.getElementById('serverStatus').className = 'status error';
                document.getElementById('serverStatus').innerHTML = `‚ùå Server is not running. Make sure to start it with: node simple-server.js`;
            }
        };
        
        // Test 1: Health Check
        async function testHealth() {
            const resultDiv = document.getElementById('healthResult');
            resultDiv.innerHTML = '<p>üîÑ Testing...</p>';
            
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                resultDiv.innerHTML = `
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        // Test 2: Get All Hostels
        async function getAllHostels() {
            const resultDiv = document.getElementById('hostelsResult');
            resultDiv.innerHTML = '<p>üîÑ Fetching hostels...</p>';
            
            try {
                const response = await fetch(`${API_URL}/hostels`);
                const data = await response.json();
                
                if (data.count === 0) {
                    resultDiv.innerHTML = '<p>üì≠ No hostels found. Create one first!</p>';
                } else {
                    let html = `<p style="color: green; font-weight: 600;">‚úÖ Found ${data.count} hostel(s)</p>`;
                    data.data.forEach((hostel, index) => {
                        html += `
                            <div class="hostel-card">
                                <h3>${index + 1}. ${hostel.name}</h3>
                                <p><strong>üìç Location:</strong> ${hostel.location}</p>
                                <p><strong>üí∞ Price:</strong> ‚Ç¶${hostel.price.toLocaleString()}</p>
                                <p><strong>üì± WhatsApp:</strong> ${hostel.whatsapp}</p>
                                <p><strong>‚úÖ Available:</strong> ${hostel.available ? 'Yes' : 'No'}</p>
                                <p><strong>üÜî ID:</strong> ${hostel._id}</p>
                            </div>
                        `;
                    });
                    resultDiv.innerHTML = html;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        // Test 3: Create New Hostel
        async function createHostel() {
            const resultDiv = document.getElementById('createResult');
            resultDiv.innerHTML = '<p>üîÑ Creating hostel...</p>';
            
            const newHostel = {
                name: "API Test Hostel " + Date.now(),
                location: "FUTA Campus",
                price: Math.floor(Math.random() * 50000) + 30000,
                image: "https://images.unsplash.com/photo-1555854877-bab0e564b8d5?auto=format&fit=crop&w=400&q=80",
                features: ["WiFi", "Security", "24/7 Power"],
                whatsapp: "234" + Math.floor(Math.random() * 1000000000),
                available: true,
                realtorId: "test-realtor-001",
                realtorName: "Test Realtor",
                description: "Created via API test"
            };
            
            try {
                const response = await fetch(`${API_URL}/hostels`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newHostel)
                });
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <p style="color: green; font-weight: 600;">‚úÖ Hostel created successfully!</p>
                    <pre>${JSON.stringify(data.data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        // Test 4: Get Realtor Hostels
        async function getRealtorHostels() {
            const realtorId = document.getElementById('realtorId').value || 'test-realtor-001';
            const resultDiv = document.getElementById('realtorResult');
            resultDiv.innerHTML = '<p>üîÑ Fetching realtor hostels...</p>';
            
            try {
                const response = await fetch(`${API_URL}/hostels/realtor/${realtorId}`);
                const data = await response.json();
                
                if (data.count === 0) {
                    resultDiv.innerHTML = `<p>üì≠ No hostels found for realtor: ${realtorId}</p>`;
                } else {
                    let html = `<p style="color: green; font-weight: 600;">‚úÖ Found ${data.count} hostel(s) for this realtor</p>`;
                    data.data.forEach((hostel, index) => {
                        html += `
                            <div class="hostel-card">
                                <h3>${index + 1}. ${hostel.name}</h3>
                                <p><strong>üí∞ Price:</strong> ‚Ç¶${hostel.price.toLocaleString()}</p>
                                <p><strong>üì± WhatsApp:</strong> ${hostel.whatsapp}</p>
                            </div>
                        `;
                    });
                    resultDiv.innerHTML = html;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        // Run All Tests
        async function runAllTests() {
            const resultDiv = document.getElementById('allTestsResult');
            resultDiv.innerHTML = '<p>üîÑ Running all tests...</p>';
            
            let results = '<h3>Test Results:</h3>';
            
            // Test 1
            try {
                await fetch(`${API_URL}/health`);
                results += '<p>‚úÖ Health Check: PASSED</p>';
            } catch {
                results += '<p>‚ùå Health Check: FAILED</p>';
            }
            
            // Test 2
            try {
                const response = await fetch(`${API_URL}/hostels`);
                const data = await response.json();
                results += `<p>‚úÖ Get All Hostels: PASSED (${data.count} hostels)</p>`;
            } catch {
                results += '<p>‚ùå Get All Hostels: FAILED</p>';
            }
            
            // Test 3
            try {
                const newHostel = {
                    name: "Full Test Hostel",
                    location: "Test Location",
                    price: 40000,
                    image: "test.jpg",
                    features: ["Test"],
                    whatsapp: "1234567890",
                    realtorId: "test-realtor"
                };
                await fetch(`${API_URL}/hostels`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newHostel)
                });
                results += '<p>‚úÖ Create Hostel: PASSED</p>';
            } catch {
                results += '<p>‚ùå Create Hostel: FAILED</p>';
            }
            
            results += '<p style="margin-top: 20px; font-weight: 600; color: #28a745;">üéâ Test suite completed!</p>';
            resultDiv.innerHTML = results;
        }
    </script>
</body>
</html>
