<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realtor Portal - MWG Hostels</title>
    <link rel="icon" type="image/png" href="MWG logo@300x.png">
    <link rel="stylesheet" href="theme-system.css">
    <link rel="stylesheet" href="theme-integration.css">
    <link rel="stylesheet" href="universal-bg-system.css">
    <link rel="stylesheet" href="perfect-vibe-theme.css">
    <link rel="stylesheet" href="glass-morphism-global.css">
    <link rel="stylesheet" href="hostel-style.css">
    <link rel="stylesheet" href="realtor-style.css">
    <link rel="stylesheet" href="modal-styles.css">
    <link rel="stylesheet" href="responsive-fixes.css">
    
    <!-- Environment Configuration -->
    <script src="env-config.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="realtor-body">
    <!-- Dynamic Background System -->
    <div class="dynamic-background"></div>
    <div class="geometric-overlay"></div>
    <div class="floating-elements">
        <div class="floating-book"></div>
        <div class="floating-graduation"></div>
        <div class="floating-building"></div>
    </div>
    <div class="particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>
    
    <!-- Navigation -->
    <nav class="navbar realtor-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="MWG logo@300x.png" alt="MWG Logo" class="logo" onerror="this.style.display='none'">
                <span class="brand-text">MWG Realtor Portal</span>
            </div>
            
            <div class="nav-menu">
                <a href="demo.html" class="nav-link">
                    <i class="fas fa-home"></i> Back to Main Site
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="realtor-main">
        <div class="container">
            <!-- Login Section -->
            <section class="realtor-login" id="loginSection">
                <div class="login-container">
                    <div class="login-card">
                        <div class="login-header">
                            <h2>Realtor Login</h2>
                            <p>Access your dashboard to manage hostel listings</p>
                        </div>
                        
                        <form class="login-form" id="realtorLoginForm">
                            <div class="form-group">
                                <label for="realtorEmail">Email Address</label>
                                <input type="email" id="realtorEmail" name="email" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="realtorPassword">Password</label>
                                <input type="password" id="realtorPassword" name="password" required>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-full">
                                <i class="fas fa-sign-in-alt"></i>
                                Login to Dashboard
                            </button>
                        </form>
                        
                        <div class="login-footer">
                            <p>Don't have an account? <a href="#" onclick="contactForRealtorAccess()" class="realtor-apply-link">Apply for Realtor Account</a></p>
                            
                            <div class="realtor-info-box">
                                <h4>üìû Need Realtor Access?</h4>
                                <p>Contact us via WhatsApp for instant account setup:</p>
                                <p><strong>New Applications:</strong> +234 814 565 3433</p>
                                <p><strong>Support & Issues:</strong> +234 806 992 8533</p>
                                <small>üîê Secure credential management ‚Ä¢ Fast approval process</small>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Dashboard Section -->
                        <section class="realtor-dashboard hidden" id="dashboardSection">
                <div class="dashboard-header">
                    <div class="realtor-profile-banner hidden" id="realtorBanner">
                        <img id="bannerImage" src="" alt="Business Banner" class="banner-image">
                        <div class="banner-overlay">
                            <div class="brand-info">
                                <h3 id="brandName">Business Name</h3>
                                <p>Managed by <span id="realtorRealName">Real Name</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="welcome-section">
                        <h2>Welcome back, <span id="realtorName">John Doe</span>!</h2>
                        <p>Manage your hostel listings and view inquiries</p>
                    </div>
                    
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-home"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number" id="totalListings">0</span>
                                <span class="stat-label">Total Listings</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-eye"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number" id="totalViews">0</span>
                                <span class="stat-label">Total Views</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number" id="totalInquiries">0</span>
                                <span class="stat-label">Inquiries</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-actions">
                    <button class="btn btn-primary" onclick="showAddHostelForm()">
                        <i class="fas fa-plus"></i>
                        Add New Hostel
                    </button>
                    <button class="btn btn-outline" onclick="refreshDashboard()">
                        <i class="fas fa-refresh"></i>
                        Refresh
                    </button>
                    <button class="btn btn-outline" onclick="debugHostels()">
                        <i class="fas fa-bug"></i>
                        Debug
                    </button>
                    <button class="btn btn-outline" onclick="addTestHostel()">
                        <i class="fas fa-plus-circle"></i>
                        Add Test Hostel
                    </button>
                    <button class="btn btn-outline" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </button>
                </div>
                
                <!-- Hostel Listings -->
                <div class="listings-section">
                    <h3>Your Hostel Listings</h3>
                    <div class="listings-grid" id="listingsGrid">
                        <!-- Listings will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Add Hostel Modal -->
            <div class="modal" id="addHostelModal">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h3>Add New Hostel</h3>
                        <button class="modal-close" onclick="closeAddHostelModal()">&times;</button>
                    </div>
                    
                    <form class="add-hostel-form" id="addHostelForm" enctype="multipart/form-data">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="hostelName">Hostel Name *</label>
                                <input type="text" id="hostelName" name="name" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="hostelLocation">Campus Location *</label>
                                <select id="hostelLocation" name="location" required>
                                    <option value="">Select Campus Area</option>
                                    <option value="North Gate">North Gate Area</option>
                                    <option value="South Gate">South Gate Area</option>
                                    <option value="West Gate">West Gate Area</option>
                                </select>
                                <small>Choose the area closest to campus gates or main locations</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="hostelPrice">Price (‚Ç¶) *</label>
                                <input type="number" id="hostelPrice" name="price" min="10000" max="500000" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="pricePeriod">Price Period *</label>
                                <select id="pricePeriod" name="pricePeriod" required>
                                    <option value="">Select Period</option>
                                    <option value="semester">Per Semester</option>
                                    <option value="year">Per Year</option>
                                    <option value="month">Per Month</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="hostelCapacity">Room Capacity *</label>
                                <select id="hostelCapacity" name="capacity" required>
                                    <option value="">Select Capacity</option>
                                    <option value="1">Single Room</option>
                                    <option value="2">2 Students per Room</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="hostelAddress">Full Address & Directions *</label>
                            <textarea id="hostelAddress" name="address" rows="4" required 
                                placeholder="Provide complete address and directions. Include:
‚Ä¢ Street name and house number
‚Ä¢ Landmarks (e.g., opposite First Bank, behind ShopRite)
‚Ä¢ Clear directions from campus gates
‚Ä¢ How to locate the building

Example: 'No. 15 Adeyemi Street, behind GTBank, North Gate Area. From North Gate, walk straight for 2 minutes, turn left at the junction after the pharmacy, the building is the 3rd house on your right - blue gate with 'Peace Lodge' written on it.'"></textarea>
                            <small>Clear directions help students find your hostel easily</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="hostelDescription">Hostel Description *</label>
                            <textarea id="hostelDescription" name="description" rows="6" required 
                                placeholder="Provide a detailed description of your hostel. Include:
‚Ä¢ Room features (e.g., spacious rooms, study tables, wardrobes)
‚Ä¢ Building quality (e.g., newly built, renovated, modern facilities)
‚Ä¢ Environment (e.g., quiet area, close to shops, security)
‚Ä¢ Special features (e.g., balcony, kitchen access, parking)
‚Ä¢ Distance from campus (e.g., 5 minutes walk to North Gate)
‚Ä¢ What makes your hostel unique

Example: 'Modern 2-bedroom apartment with spacious rooms, each with study table and wardrobe. Located 3 minutes walk from North Gate with 24/7 security. Newly renovated building with reliable power supply and water. Quiet environment perfect for studying. Kitchen and laundry facilities available.'"></textarea>
                            <small>Be detailed and honest - this helps students make better decisions</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Amenities & Features *</label>
                            <div class="amenities-grid">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="amenities" value="WiFi">
                                    <span>WiFi Internet</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="amenities" value="AC">
                                    <span>Air Conditioning</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="amenities" value="Kitchen">
                                    <span>Kitchen/Cooking Space</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="amenities" value="Laundry">
                                    <span>Laundry Service</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="amenities" value="Security">
                                    <span>24/7 Security</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="amenities" value="Generator">
                                    <span>Generator/Power Backup</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="amenities" value="Solar Inverter">
                                    <span>Solar Inverter</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="amenities" value="Solar Water System">
                                    <span>Solar Powered Water System</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="amenities" value="Parking">
                                    <span>Running water</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="amenities" value="Study Room">
                                    <span>Study Room</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" id="otherAmenityCheckRealtor" name="amenities" value="other" onchange="toggleOtherAmenityRealtor()">
                                    <span>Others</span>
                                </label>
                            </div>
                            
                            <!-- Others field -->
                            <div class="form-group other-amenity-group" id="otherAmenityGroupRealtor">
                                <label for="otherAmenityRealtor">Specify Other Amenities</label>
                                <input type="text" id="otherAmenityRealtor" name="otherAmenity" placeholder="e.g., Swimming Pool, Gym, Recreation Room, etc.">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="hostelImages">Hostel Photos * (Upload 3-8 photos)</label>
                            <div class="file-upload-area">
                                <input type="file" id="hostelImages" name="images" multiple accept="image/*" required>
                                <label for="hostelImages" class="file-upload-label">
                                    <i class="fas fa-camera"></i>
                                    <span>Click to upload photos</span>
                                    <small>Select multiple high-quality images of your hostel</small>
                                </label>
                                <div class="image-previews" id="imagePreviews"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="hostelVideos">Hostel Videos (Optional - Upload 1-3 videos)</label>
                            <div class="file-upload-area">
                                <input type="file" id="hostelVideos" name="videos" multiple accept="video/*">
                                <label for="hostelVideos" class="file-upload-label">
                                    <i class="fas fa-video"></i>
                                    <span>Click to upload videos</span>
                                    <small>Upload videos to showcase your hostel (Max 50MB per video)</small>
                                </label>
                                <div class="video-previews" id="videoPreviews"></div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="contactPhone">Contact Phone *</label>
                                <input type="tel" id="contactPhone" name="phone" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="contactWhatsApp">WhatsApp Number</label>
                                <input type="tel" id="contactWhatsApp" name="whatsapp" placeholder="For direct WhatsApp contact">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="checkbox-container">
                                <input type="checkbox" name="verified" required>
                                <span class="checkmark"></span>
                                I confirm that all information provided is accurate and the hostel meets safety standards
                            </label>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" onclick="closeAddHostelModal()">Cancel</button>
                            <button type="button" class="btn btn-secondary" onclick="clearForm()">Clear Form</button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                Add Hostel Listing
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <style>
        /* Other Amenity Styles */
        .other-amenity-group {
            display: none;
            margin-top: 1rem;
        }
        
        .other-amenity-group.show {
            display: block;
        }
        
        /* Realtor Apply Link */
        .realtor-apply-link {
            color: #3b82f6;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .realtor-apply-link:hover {
            color: #1d4ed8;
            text-decoration: underline;
        }
        
        /* Realtor Info Box */
        .realtor-info-box {
            background: linear-gradient(135deg, #e0f2fe 0%, #f1f5f9 100%);
            border: 1px solid #0ea5e9;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }
        
        .realtor-info-box h4 {
            margin: 0 0 10px 0;
            color: #0f172a;
            font-size: 1.1em;
        }
        
        .realtor-info-box p {
            margin: 5px 0;
            color: #334155;
        }
        
        .realtor-info-box strong {
            color: #0ea5e9;
        }
        
        .realtor-info-box small {
            color: #64748b;
            font-style: italic;
        }
        
        /* Listing Card Enhancements */
        .listing-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .listing-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }
        
        .listing-image {
            position: relative;
            margin-bottom: 15px;
        }
        
        .listing-header {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .listing-details {
            padding: 15px;
        }
        
        .listing-details p {
            margin: 8px 0;
            color: #64748b;
            font-size: 14px;
        }
        
        .listing-details i {
            color: #3b82f6;
            margin-right: 8px;
            width: 16px;
        }
        
        .listing-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .listing-status.available {
            background: #dcfce7;
            color: #166534;
        }
        
        .listing-status.allocated {
            background: #fef3c7;
            color: #d97706;
        }
        
        /* Allocation Status */
        .allocation-status {
            padding: 15px;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
            background: #f8fafc;
        }
        
        .allocation-checkbox {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            color: #475569;
        }
        
        .allocation-checkbox input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.2);
            accent-color: #3b82f6;
        }
        
        /* Listing Actions */
        .listing-actions {
            padding: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .btn-danger {
            background: #dc2626;
            color: white;
            border: 1px solid #dc2626;
        }
        
        .btn-danger:hover {
            background: #b91c1c;
            border-color: #b91c1c;
        }
        
        /* No Listings State */
        .no-listings {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }
        
        .no-listings i {
            font-size: 48px;
            color: #cbd5e1;
            margin-bottom: 20px;
        }
        
        .no-listings h3 {
            margin: 0 0 10px 0;
            font-size: 24px;
            color: #334155;
        }
        
        .no-listings p {
            margin: 0 0 20px 0;
            font-size: 16px;
        }
        
        /* Modal Enhancements */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex !important;
        }
    </style>
    
    <script>
        // Global state for realtor dashboard
        const realtorState = {
            isLoggedIn: false,
            realtorData: null,
            hostels: []
        };
        
        // Toggle other amenity field for realtor
        function toggleOtherAmenityRealtor() {
            const checkbox = document.getElementById('otherAmenityCheckRealtor');
            const otherGroup = document.getElementById('otherAmenityGroupRealtor');
            const otherInput = document.getElementById('otherAmenityRealtor');
            
            if (checkbox && otherGroup && otherInput) {
                if (checkbox.checked) {
                    otherGroup.classList.add('show');
                    otherInput.focus();
                } else {
                    otherGroup.classList.remove('show');
                    otherInput.value = '';
                }
            }
        }
        
        // Modal functions
        function showAddHostelForm() {
            const modal = document.getElementById('addHostelModal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeAddHostelModal() {
            const modal = document.getElementById('addHostelModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        function clearForm() {
            if (confirm('‚ö†Ô∏è Are you sure you want to clear all form data?')) {
                const form = document.getElementById('addHostelForm');
                if (form) {
                    form.reset();
                    // Clear any other amenity input
                    const otherGroup = document.getElementById('otherAmenityGroupRealtor');
                    if (otherGroup) {
                        otherGroup.classList.remove('show');
                    }
                    alert('‚úÖ Form cleared!');
                }
            }
        }
        
        // WhatsApp contact function for realtor application
        function contactForRealtorAccess() {
            const whatsappNumber = "2348145653433"; // Updated number for new realtor applications
            const message = encodeURIComponent("Hello! I would like to apply for a realtor account on MWG Hostels platform. Please provide me with login credentials. Thank you!");
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${message}`;
            
            // Show confirmation dialog
            const userConfirmed = confirm(
                "To become a realtor on MWG Hostels platform:\n\n" +
                "‚Ä¢ Contact us via WhatsApp for account setup\n" +
                "‚Ä¢ We'll verify your credentials and provide login access\n" +
                "‚Ä¢ This ensures secure account management\n\n" +
                "Click OK to open WhatsApp and send your application message."
            );
            
            if (userConfirmed) {
                window.open(whatsappUrl, '_blank');
            }
        }
        
        function refreshDashboard() {
            if (realtorState.isLoggedIn) {
                loadRealtorHostels();
                updateDashboardStats();
                alert('Dashboard refreshed successfully!');
            }
        }
        
        function debugHostels() {
            const stored = localStorage.getItem('realtorHostels');
            const hostels = stored ? JSON.parse(stored) : [];
            
            console.log('üêõ DEBUG: Stored hostels:', hostels);
            console.log('üêõ DEBUG: Current state hostels:', realtorState.hostels);
            console.log('üêõ DEBUG: localStorage keys:', Object.keys(localStorage));
            
            alert(`üêõ DEBUG INFO:\n\nStored hostels: ${hostels.length}\nCurrent state hostels: ${realtorState.hostels.length}\n\nCheck console for detailed data.`);
            
            // Force refresh
            loadRealtorHostels();
        }
        
        function addTestHostel() {
            const testHostel = {
                id: 'test_hostel_' + Date.now(),
                name: 'Test Hostel - ' + new Date().toLocaleTimeString(),
                location: 'North Gate',
                price: 50000,
                pricePeriod: 'semester',
                capacity: '2',
                address: 'Test Address, North Gate Area',
                description: 'This is a test hostel to verify the system is working properly.',
                amenities: ['WiFi', 'Security', 'Generator'],
                phone: '08012345678',
                whatsapp: '08012345678',
                images: ['https://images.unsplash.com/photo-1555854877-bab0e921b58d?auto=format&fit=crop&w=800&q=80'],
                videoCount: 0,
                videos: [],
                status: 'available',
                views: Math.floor(Math.random() * 20),
                inquiries: Math.floor(Math.random() * 5),
                dateAdded: new Date().toISOString(),
                lastUpdated: new Date().toISOString(),
                realtorId: realtorState.realtorData?.email || 'test',
                verified: true
            };
            
            try {
                const existingHostels = JSON.parse(localStorage.getItem('realtorHostels') || '[]');
                existingHostels.push(testHostel);
                
                // Use sync function to update both storage keys
                if (syncHostelData(existingHostels)) {
                    realtorState.hostels = existingHostels;
                    
                    console.log('‚úÖ Test hostel added:', testHostel);
                    alert('‚úÖ Test hostel added successfully!');
                    
                    loadRealtorHostels();
                    updateDashboardStats();
                } else {
                    alert('‚ùå Error syncing hostel data');
                }
                
            } catch (error) {
                console.error('‚ùå Error adding test hostel:', error);
                alert('‚ùå Error adding test hostel: ' + error.message);
            }
        }
        
        // CRITICAL: Sync data to both storage keys for student/realtor compatibility
        function syncHostelData(hostels) {
            try {
                // Save to realtor storage (for realtor dashboard)
                localStorage.setItem('realtorHostels', JSON.stringify(hostels));
                
                // Also save to student-expected format (for demo.html compatibility)
                const studentFormat = hostels.map(hostel => ({
                    id: hostel.id,
                    name: hostel.name,
                    location: hostel.location,
                    price: parseInt(hostel.price), // Remove formatting for calculations
                    images: hostel.images || [],
                    realtorInfo: hostel.realtorInfo || {
                        fullName: hostel.realtorInfo?.fullName || "Verified Realtor",
                        brandName: hostel.realtorInfo?.brandName || "Verified Realtor",
                        name: hostel.realtorInfo?.fullName || "Verified Realtor"
                    },
                    phone: hostel.phone,
                    whatsapp: hostel.whatsapp,
                    status: hostel.status === 'available' ? 'active' : 'allocated',
                    capacity: hostel.capacity,
                    description: hostel.description,
                    amenities: hostel.amenities || [],
                    address: hostel.address,
                    views: hostel.views || 0,
                    inquiries: hostel.inquiries || 0,
                    dateAdded: hostel.dateAdded,
                    lastUpdated: hostel.lastUpdated
                }));
                
                localStorage.setItem('realtorListings', JSON.stringify(studentFormat));
                console.log('‚úÖ Data synced to both storage keys:', hostels.length, 'hostels');
                
                return true;
            } catch (error) {
                console.error('‚ùå Error syncing hostel data:', error);
                return false;
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                realtorState.isLoggedIn = false;
                realtorState.realtorData = null;
                localStorage.removeItem('realtorSession');
                
                document.getElementById('dashboardSection').classList.add('hidden');
                document.getElementById('loginSection').classList.remove('hidden');
                
                alert('Logged out successfully!');
            }
        }
        
        // Dashboard functions - FIXED VERSION
        function loadRealtorHostels() {
            console.log('üîÑ Loading realtor hostels...');
            
            // Load hostels from localStorage
            let hostels = [];
            try {
                const stored = localStorage.getItem('realtorHostels');
                hostels = stored ? JSON.parse(stored) : [];
                console.log('üì¶ Loaded hostels from storage:', hostels.length);
            } catch (error) {
                console.error('‚ùå Error loading hostels:', error);
                hostels = [];
            }
            
            realtorState.hostels = hostels;
            
            const grid = document.getElementById('listingsGrid');
            if (!grid) {
                console.error('‚ùå Listings grid not found - checking if dashboard is visible');
                const dashboard = document.getElementById('dashboardSection');
                console.log('Dashboard section:', dashboard ? 'found' : 'not found');
                console.log('Dashboard visible:', dashboard ? !dashboard.classList.contains('hidden') : 'N/A');
                
                // Try again after a short delay
                setTimeout(() => {
                    const gridRetry = document.getElementById('listingsGrid');
                    if (gridRetry) {
                        console.log('‚úÖ Grid found on retry, continuing...');
                        renderHostelGrid(gridRetry, hostels);
                    } else {
                        console.error('‚ùå Grid still not found after retry');
                    }
                }, 500);
                return;
            }
            
            renderHostelGrid(grid, hostels);
        }
        
        function renderHostelGrid(grid, hostels) {
            if (hostels.length === 0) {
                grid.innerHTML = `
                    <div class="no-listings">
                        <i class="fas fa-home"></i>
                        <h3>No Hostels Listed Yet</h3>
                        <p>Start by adding your first hostel listing!</p>
                        <button class="btn btn-primary" onclick="showAddHostelForm()">
                            <i class="fas fa-plus"></i> Add Your First Hostel
                        </button>
                    </div>
                `;
            } else {
                console.log('üè† Displaying', hostels.length, 'hostels');
                
                grid.innerHTML = hostels.map((hostel, index) => {
                    console.log(`Rendering hostel ${index + 1}:`, hostel.name);
                    
                    return `
                        <div class="listing-card" data-hostel-id="${hostel.id}">
                            <div class="listing-image">
                                <img src="${hostel.images && hostel.images[0] ? hostel.images[0] : 'https://images.unsplash.com/photo-1555854877-bab0e921b58d?auto=format&fit=crop&w=800&q=80'}" 
                                     alt="${hostel.name}" 
                                     style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px 8px 0 0;"
                                     onerror="this.src='https://images.unsplash.com/photo-1555854877-bab0e921b58d?auto=format&fit=crop&w=800&q=80'">
                            </div>
                            <div class="listing-content" style="padding: 15px;">
                                <div class="listing-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <h4 style="margin: 0; color: #1e293b;">${hostel.name}</h4>
                                    <span class="listing-status ${hostel.status === 'allocated' ? 'allocated' : 'available'}" 
                                          style="padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                        ${hostel.status === 'allocated' ? 'ALLOCATED' : 'AVAILABLE'}
                                    </span>
                                </div>
                                
                                <div class="listing-details" style="margin-bottom: 15px;">
                                    <p style="margin: 5px 0; color: #64748b; font-size: 14px;">
                                        <i class="fas fa-map-marker-alt" style="color: #3b82f6; margin-right: 8px;"></i>
                                        <strong>${hostel.location}</strong> - Campus Area
                                    </p>
                                    <p style="margin: 5px 0; color: #64748b; font-size: 14px;">
                                        <i class="fas fa-money-bill" style="color: #3b82f6; margin-right: 8px;"></i>
                                        ‚Ç¶${parseInt(hostel.price).toLocaleString()} per ${hostel.pricePeriod || 'semester'}
                                    </p>
                                    <p style="margin: 5px 0; color: #64748b; font-size: 14px;">
                                        <i class="fas fa-users" style="color: #3b82f6; margin-right: 8px;"></i>
                                        ${hostel.capacity} student${hostel.capacity > 1 ? 's' : ''} per room
                                    </p>
                                    <p style="margin: 5px 0; color: #64748b; font-size: 14px;">
                                        <i class="fas fa-calendar-plus" style="color: #3b82f6; margin-right: 8px;"></i>
                                        Added: ${new Date(hostel.dateAdded).toLocaleDateString()}
                                    </p>
                                    <p style="margin: 5px 0; color: #64748b; font-size: 14px;">
                                        <i class="fas fa-eye" style="color: #3b82f6; margin-right: 8px;"></i>
                                        ${hostel.views || 0} views ‚Ä¢ ${hostel.inquiries || 0} inquiries
                                    </p>
                                </div>
                                
                                <div class="allocation-status" style="padding: 10px 0; border-top: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0; margin: 15px 0;">
                                    <label class="allocation-checkbox" style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" ${hostel.status === 'allocated' ? 'checked' : ''} 
                                               onchange="toggleAllocation('${hostel.id}', this.checked)"
                                               style="margin-right: 8px; transform: scale(1.2);">
                                        <span style="font-size: 14px; color: #475569;">Mark as Allocated</span>
                                    </label>
                                </div>
                                
                                <div class="listing-actions" style="display: flex; gap: 8px; justify-content: center;">
                                    <button class="btn btn-outline btn-sm" onclick="editHostelSimple('${hostel.id}')" 
                                            style="padding: 6px 12px; font-size: 12px; border: 1px solid #3b82f6; color: #3b82f6; background: white; border-radius: 6px; cursor: pointer;">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-info btn-sm" onclick="viewHostelDetails('${hostel.id}')"
                                            style="padding: 6px 12px; font-size: 12px; border: 1px solid #10b981; color: #10b981; background: white; border-radius: 6px; cursor: pointer;">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteHostelConfirm('${hostel.id}')"
                                            style="padding: 6px 12px; font-size: 12px; border: 1px solid #dc2626; color: #dc2626; background: white; border-radius: 6px; cursor: pointer;">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                console.log('‚úÖ Hostels rendered successfully');
            }
        }
        }
        
        function updateDashboardStats() {
            const totalListings = realtorState.hostels.length;
            const totalViews = realtorState.hostels.reduce((sum, h) => sum + (h.views || 0), 0);
            const totalInquiries = realtorState.hostels.reduce((sum, h) => sum + (h.inquiries || 0), 0);
            
            document.getElementById('totalListings').textContent = totalListings;
            document.getElementById('totalViews').textContent = totalViews;
            document.getElementById('totalInquiries').textContent = totalInquiries;
        }
        
        // ENHANCED EDIT FUNCTION
        function editHostelSimple(hostelId) {
            console.log('üîß Editing hostel:', hostelId);
            
            const hostel = realtorState.hostels.find(h => h.id === hostelId);
            if (!hostel) {
                alert('‚ùå Hostel not found!');
                return;
            }
            
            // Create a comprehensive edit dialog
            const editData = {};
            
            // Edit basic information
            editData.name = prompt('üìù Edit Hostel Name:', hostel.name);
            if (editData.name === null) return; // User cancelled
            
            // Edit location with dropdown options
            const locations = ['North Gate', 'South Gate', 'Main Campus', 'School Gate'];
            const locationIndex = prompt(`üìç Select Location (enter number):\n1. North Gate\n2. South Gate\n3. Main Campus\n4. School Gate\n\nCurrent: ${hostel.location}`, 
                locations.indexOf(hostel.location) + 1 || 1);
            if (locationIndex === null) return;
            editData.location = locations[parseInt(locationIndex) - 1] || hostel.location;
            
            // Edit price
            editData.price = prompt('üí∞ Edit Price (‚Ç¶):', hostel.price);
            if (editData.price === null) return;
            
            // Edit capacity
            const capacityOptions = ['1', '2', '3', '4'];
            const capacityIndex = prompt(`üë• Select Room Capacity (enter number):\n1. 1 student per room\n2. 2 students per room\n3. 3 students per room\n4. 4 students per room\n\nCurrent: ${hostel.capacity}`, 
                hostel.capacity);
            if (capacityIndex === null) return;
            editData.capacity = parseInt(capacityIndex) || hostel.capacity;
            
            // Edit address
            editData.address = prompt('üè† Edit Address:', hostel.address);
            if (editData.address === null) return;
            
            // Edit description
            editData.description = prompt('üìù Edit Description:', hostel.description);
            if (editData.description === null) return;
            
            // Edit phone
            editData.phone = prompt('üìû Edit Contact Phone:', hostel.phone);
            if (editData.phone === null) return;
            
            // Update the hostel
            const hostelIndex = realtorState.hostels.findIndex(h => h.id === hostelId);
            if (hostelIndex !== -1) {
                realtorState.hostels[hostelIndex] = {
                    ...realtorState.hostels[hostelIndex],
                    name: editData.name.trim() || hostel.name,
                    location: editData.location || hostel.location,
                    price: parseInt(editData.price) || hostel.price,
                    capacity: editData.capacity || hostel.capacity,
                    address: editData.address.trim() || hostel.address,
                    description: editData.description.trim() || hostel.description,
                    phone: editData.phone.trim() || hostel.phone,
                    lastUpdated: new Date().toISOString()
                };
                
                // Save to localStorage using sync function
                if (syncHostelData(realtorState.hostels)) {
                    alert(`‚úÖ "${editData.name || hostel.name}" updated successfully!\n\nüìç Location: ${editData.location || hostel.location}\nüí∞ Price: ‚Ç¶${parseInt(editData.price || hostel.price).toLocaleString()}\nüë• Capacity: ${editData.capacity || hostel.capacity} per room`);
                    
                    // Refresh display
                    loadRealtorHostels();
                    updateDashboardStats();
                } else {
                    alert('‚ùå Error syncing hostel data');
                }
            }
        }
        
        function viewHostelDetails(hostelId) {
            const hostel = realtorState.hostels.find(h => h.id === hostelId);
            if (!hostel) {
                alert('‚ùå Hostel not found!');
                return;
            }
            
            alert(`üè† ${hostel.name}\n\nüìç Location: ${hostel.location}\nüí∞ Price: ‚Ç¶${parseInt(hostel.price).toLocaleString()} per ${hostel.pricePeriod}\nüë• Capacity: ${hostel.capacity} per room\nüìÖ Added: ${new Date(hostel.dateAdded).toLocaleDateString()}\nüìù Description: ${hostel.description}\nüìû Phone: ${hostel.phone}\nüè∑Ô∏è Status: ${hostel.status === 'allocated' ? 'Allocated' : 'Available'}`);
        }
        
        function deleteHostelConfirm(hostelId) {
            const hostel = realtorState.hostels.find(h => h.id === hostelId);
            if (!hostel) {
                alert('‚ùå Hostel not found!');
                return;
            }
            
            if (confirm(`‚ö†Ô∏è Are you sure you want to delete "${hostel.name}"?\n\nThis action cannot be undone.`)) {
                // Remove from array
                realtorState.hostels = realtorState.hostels.filter(h => h.id !== hostelId);
                
                // Save to localStorage using sync function
                if (syncHostelData(realtorState.hostels)) {
                    alert('‚úÖ Hostel deleted successfully!');
                    
                    // Refresh display
                    loadRealtorHostels();
                    updateDashboardStats();
                } else {
                    alert('‚ùå Error syncing hostel data after deletion');
                }
            }
        }
        
        function toggleAllocation(hostelId, isAllocated) {
            console.log('üîÑ Toggling allocation for:', hostelId, 'to:', isAllocated);
            
            const hostelIndex = realtorState.hostels.findIndex(h => h.id === hostelId);
            if (hostelIndex !== -1) {
                realtorState.hostels[hostelIndex].status = isAllocated ? 'allocated' : 'available';
                realtorState.hostels[hostelIndex].lastUpdated = new Date().toISOString();
                
                // Save to localStorage using sync function
                if (syncHostelData(realtorState.hostels)) {
                    console.log('‚úÖ Allocation status updated');
                    
                    // Refresh display immediately
                    loadRealtorHostels();
                    
                    alert(`‚úÖ Hostel marked as ${isAllocated ? 'allocated' : 'available'}!`);
                } else {
                    alert('‚ùå Error syncing hostel data');
                }
            } else {
                console.error('‚ùå Hostel not found for ID:', hostelId);
            }
        }
        
        // Form submissions
        document.addEventListener('DOMContentLoaded', function() {
            // Login form
            document.getElementById('realtorLoginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const email = formData.get('email');
                const password = formData.get('password');
                
                if (!email || !password) {
                    alert('Please fill in all fields');
                    return;
                }
                
                // Realtor authentication with all available credentials
                const realtorCredentials = [
                    {
                        email: 'admin@mwghostels.com',
                        password: 'sama2024',
                        name: 'Administrator',
                        businessName: 'MWG Premium Properties'
                    },
                    {
                        email: 'demo@realtor.com',
                        password: 'demo123',
                        name: 'Demo Realtor',
                        businessName: 'Demo Properties Ltd'
                    },
                    {
                        email: 'realtor@mwghostels.com',
                        password: 'futarian',
                        name: 'John Smith',
                        businessName: 'FUTA Student Housing Co.'
                    },
                    {
                        email: 'manager@mwghostels.com',
                        password: 'mwgrealtor',
                        name: 'Sarah Johnson',
                        businessName: 'Campus Living Solutions'
                    },
                    {
                        email: 'sama@mwghostels.com',
                        password: 'sama2024',
                        name: 'Oluwaseun Great Sama',
                        businessName: 'SAMA Properties'
                    },
                    {
                        email: 'michael@mwghostels.com',
                        password: 'michael2024',
                        name: 'Michael Adebayo',
                        businessName: 'Elite Student Homes'
                    },
                    {
                        email: 'funmi@mwghostels.com',
                        password: 'funmi2024',
                        name: 'Funmilayo Ogundimu',
                        businessName: 'Comfort Lodge Properties'
                    },
                    {
                        email: 'david@mwghostels.com',
                        password: 'david2024',
                        name: 'David Oluwaseun',
                        businessName: 'Premium Campus Residence'
                    },
                    {
                        email: 'blessing@mwghostels.com',
                        password: 'blessing2024',
                        name: 'Blessing Adeyemi',
                        businessName: 'Student Haven Properties'
                    }
                ];

                // Find matching credentials
                const validRealtor = realtorCredentials.find(cred => 
                    cred.email === email && cred.password === password
                );

                if (validRealtor) {
                    realtorState.isLoggedIn = true;
                    realtorState.realtorData = {
                        name: validRealtor.name,
                        email: validRealtor.email,
                        businessName: validRealtor.businessName
                    };
                    
                    localStorage.setItem('realtorSession', JSON.stringify(realtorState.realtorData));
                    
                    document.getElementById('loginSection').classList.add('hidden');
                    document.getElementById('dashboardSection').classList.remove('hidden');
                    document.getElementById('realtorName').textContent = realtorState.realtorData.name;
                    
                    // Add debug logging
                    console.log('üîê Login successful, loading hostels...');
                    
                    // Force load hostels after a short delay
                    setTimeout(() => {
                        // Initialize sample hostels if needed
                        const initialized = initializeSampleHostels();
                        if (initialized) {
                            console.log('üì¶ Sample hostels added for first-time login');
                        }
                        
                        loadRealtorHostels();
                        updateDashboardStats();
                        console.log('üìä Dashboard loaded with hostels:', realtorState.hostels.length);
                    }, 100);
                    
                    alert(`Login successful! Welcome ${validRealtor.name} from ${validRealtor.businessName}.`);
                } else {
                    // Secure error message - never reveals actual credentials
                    alert('üîê Access Denied\n\nInvalid login credentials. Please check your email and password.\n\nüìû Need Help?\n‚Ä¢ Account Issues: +234 806 992 8533\n‚Ä¢ New Account: +234 814 565 3433\n\n‚ö†Ô∏è For security, we cannot display or hint at actual passwords.');
                }
            });
            
            // IMPROVED Add hostel form submission with better validation
            document.getElementById('addHostelForm').addEventListener('submit', function(e) {
                e.preventDefault();
                console.log('üìù Add hostel form submitted');
                
                const formData = new FormData(e.target);
                
                // Get form values
                const name = formData.get('name')?.trim();
                const location = formData.get('location');
                const price = formData.get('price');
                const pricePeriod = formData.get('pricePeriod');
                const capacity = formData.get('capacity');
                const address = formData.get('address')?.trim();
                const description = formData.get('description')?.trim();
                const phone = formData.get('phone')?.trim();
                
                // Detailed validation
                if (!name) {
                    alert('‚ùå Please enter the hostel name');
                    document.getElementById('hostelName').focus();
                    return;
                }
                
                if (!location) {
                    alert('‚ùå Please select a campus location');
                    document.getElementById('hostelLocation').focus();
                    return;
                }
                
                if (!price || price < 10000) {
                    alert('‚ùå Please enter a valid price (minimum ‚Ç¶10,000)');
                    document.getElementById('hostelPrice').focus();
                    return;
                }
                
                if (!pricePeriod) {
                    alert('‚ùå Please select the price period');
                    document.getElementById('pricePeriod').focus();
                    return;
                }
                
                if (!capacity) {
                    alert('‚ùå Please select room capacity');
                    document.getElementById('hostelCapacity').focus();
                    return;
                }
                
                if (!address || address.length < 10) {
                    alert('‚ùå Please provide a detailed address (at least 10 characters)');
                    document.getElementById('hostelAddress').focus();
                    return;
                }
                
                if (!description || description.length < 20) {
                    alert('‚ùå Please provide a detailed description (at least 20 characters)');
                    document.getElementById('hostelDescription').focus();
                    return;
                }
                
                if (!phone) {
                    alert('‚ùå Please enter contact phone number');
                    document.getElementById('contactPhone').focus();
                    return;
                }
                
                // Collect amenities
                const amenities = [];
                const amenityCheckboxes = document.querySelectorAll('input[name="amenities"]:checked');
                amenityCheckboxes.forEach(checkbox => {
                    if (checkbox.value === 'other') {
                        const otherInput = document.querySelector('input[name="otherAmenity"]');
                        if (otherInput && otherInput.value.trim()) {
                            amenities.push(otherInput.value.trim());
                        }
                    } else {
                        amenities.push(checkbox.value);
                    }
                });
                
                if (amenities.length === 0) {
                    alert('‚ùå Please select at least one amenity');
                    return;
                }
                
                // Show loading state
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding Hostel...';
                submitBtn.disabled = true;
                
                // Create hostel data with improved structure
                const hostelData = {
                    id: 'hostel_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name: name,
                    location: location,
                    price: parseInt(price),
                    pricePeriod: pricePeriod,
                    capacity: capacity,
                    address: address,
                    description: description,
                    amenities: amenities,
                    phone: phone,
                    whatsapp: formData.get('whatsapp') || phone,
                    images: window.uploadedImageUrls && window.uploadedImageUrls.length > 0 ? 
                        window.uploadedImageUrls : [
                            'https://images.unsplash.com/photo-1555854877-bab0e921b58d?auto=format&fit=crop&w=800&q=80',
                            'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=800&q=80'
                        ],
                    videoCount: 0,
                    videos: [],
                    status: 'available',
                    views: Math.floor(Math.random() * 50), // Random initial views
                    inquiries: 0,
                    dateAdded: new Date().toISOString(),
                    lastUpdated: new Date().toISOString(),
                    realtorId: realtorState.realtorData?.email || 'demo',
                    verified: true,
                    realtorInfo: {
                        fullName: realtorState.realtorData?.name || 'Verified Realtor',
                        brandName: realtorState.realtorData?.businessName || 'Verified Business',
                        email: realtorState.realtorData?.email || 'contact@mwghostels.com'
                    }
                };
                
                console.log('üè† Creating hostel:', hostelData);
                
                // Simulate processing time
                setTimeout(() => {
                    try {
                        // Save to localStorage using sync function
                        const existingHostels = JSON.parse(localStorage.getItem('realtorHostels') || '[]');
                        existingHostels.push(hostelData);
                        
                        if (syncHostelData(existingHostels)) {
                            // Update state
                            realtorState.hostels = existingHostels;
                            
                            console.log('‚úÖ Hostel saved and synced! Total hostels:', existingHostels.length);
                            
                            // Reset button
                            submitBtn.innerHTML = originalText;
                            submitBtn.disabled = false;
                            
                            alert(`‚úÖ "${name}" has been added successfully!\n\nüìç Location: ${location}\nüí∞ Price: ‚Ç¶${parseInt(price).toLocaleString()} per ${pricePeriod}\nüë• Capacity: ${capacity} per room\n\nYour hostel is now visible to students!`);
                            
                            // Reset form and close modal
                            e.target.reset();
                            
                            // Clear uploaded images
                            window.uploadedImageUrls = [];
                            document.getElementById('imagePreviews').innerHTML = '';
                            
                            closeAddHostelModal();
                            
                            // Refresh dashboard
                            loadRealtorHostels();
                            updateDashboardStats();
                        } else {
                            // Sync failed - reset button and show error
                            submitBtn.innerHTML = originalText;
                            submitBtn.disabled = false;
                            
                            alert('‚ùå Error syncing hostel data. The hostel was saved but may not appear immediately to students. Please try again.');
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Error saving hostel:', error);
                        
                        // Reset button
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                        
                        alert('‚ùå Error saving hostel. Please try again.');
                    }
                }, 1000); // 1 second delay to show loading
            });
            
            // File upload previews
            document.getElementById('hostelImages').addEventListener('change', function(e) {
                const files = e.target.files;
                const previews = document.getElementById('imagePreviews');
                
                if (files.length < 3 || files.length > 8) {
                    alert('Please upload between 3 and 8 images');
                    e.target.value = '';
                    return;
                }
                
                // Clear previous previews
                previews.innerHTML = '';
                
                // Store image URLs for form submission
                window.uploadedImageUrls = [];
                
                // Create image previews
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    
                    // Check file type
                    if (!file.type.startsWith('image/')) {
                        alert(`"${file.name}" is not a valid image file`);
                        continue;
                    }
                    
                    // Check file size (5MB limit)
                    if (file.size > 5 * 1024 * 1024) {
                        alert(`Image "${file.name}" is too large. Each image must be under 5MB`);
                        continue;
                    }
                    
                    // Create image preview
                    const imageContainer = document.createElement('div');
                    imageContainer.className = 'image-preview-item';
                    imageContainer.style.cssText = 'display: inline-block; margin: 10px; position: relative; border: 2px solid #e2e8f0; border-radius: 8px; overflow: hidden;';
                    
                    const img = document.createElement('img');
                    const imageUrl = URL.createObjectURL(file);
                    img.src = imageUrl;
                    img.style.cssText = 'width: 120px; height: 80px; object-fit: cover; display: block;';
                    
                    // Store the URL for form submission
                    window.uploadedImageUrls.push(imageUrl);
                    
                    const fileName = document.createElement('div');
                    fileName.textContent = file.name;
                    fileName.style.cssText = 'padding: 5px; font-size: 12px; background: #f8fafc; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;';
                    
                    imageContainer.appendChild(img);
                    imageContainer.appendChild(fileName);
                    previews.appendChild(imageContainer);
                }
                
                const summary = document.createElement('div');
                summary.style.cssText = 'width: 100%; text-align: center; margin-top: 10px; color: #10b981; font-weight: 600;';
                summary.textContent = `‚úÖ ${window.uploadedImageUrls.length} images ready for upload`;
                previews.appendChild(summary);
            });
            
            document.getElementById('hostelVideos').addEventListener('change', function(e) {
                const files = e.target.files;
                const previews = document.getElementById('videoPreviews');
                
                if (files.length > 3) {
                    alert('Please upload a maximum of 3 videos');
                    e.target.value = '';
                    return;
                }
                
                // Check file sizes and create previews
                previews.innerHTML = '';
                let validFiles = 0;
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    
                    // Check file size (50MB limit)
                    if (file.size > 50 * 1024 * 1024) {
                        alert(`Video "${file.name}" is too large. Each video must be under 50MB`);
                        continue;
                    }
                    
                    // Check file type
                    if (!file.type.startsWith('video/')) {
                        alert(`"${file.name}" is not a valid video file`);
                        continue;
                    }
                    
                    validFiles++;
                    
                    // Create video preview
                    const videoContainer = document.createElement('div');
                    videoContainer.className = 'video-preview-item';
                    videoContainer.style.cssText = 'display: inline-block; margin: 10px; position: relative;';
                    
                    const video = document.createElement('video');
                    video.src = URL.createObjectURL(file);
                    video.controls = true;
                    video.style.cssText = 'width: 200px; height: 150px; border-radius: 8px; object-fit: cover;';
                    
                    const fileName = document.createElement('p');
                    fileName.textContent = file.name;
                    fileName.style.cssText = 'margin: 5px 0; font-size: 12px; text-align: center; color: #666;';
                    
                    const fileSize = document.createElement('small');
                    fileSize.textContent = `${(file.size / (1024 * 1024)).toFixed(1)} MB`;
                    fileSize.style.cssText = 'color: #999; font-size: 11px; display: block; text-align: center;';
                    
                    videoContainer.appendChild(video);
                    videoContainer.appendChild(fileName);
                    videoContainer.appendChild(fileSize);
                    previews.appendChild(videoContainer);
                }
                
                if (validFiles === 0) {
                    previews.innerHTML = '<p style="color: #666;">No valid videos selected</p>';
                    e.target.value = '';
                } else {
                    const summary = document.createElement('p');
                    summary.innerHTML = `<strong>‚úÖ ${validFiles} video${validFiles > 1 ? 's' : ''} ready for upload</strong>`;
                    summary.style.cssText = 'color: #22c55e; font-weight: 500; text-align: center; margin: 10px 0;';
                    previews.insertBefore(summary, previews.firstChild);
                }
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    closeAddHostelModal();
                }
            });
            
            // Initialize sample hostels if none exist
            function initializeSampleHostels() {
                try {
                    const existing = localStorage.getItem('realtorHostels');
                    if (existing && JSON.parse(existing).length > 0) {
                        console.log('‚úÖ Hostels already exist, skipping initialization');
                        return false;
                    }
                    
                    const sampleHostels = [
                        {
                            id: 'hostel_sample_1',
                            name: 'Premium Student Lodge',
                            location: 'North Gate',
                            price: 45000,
                            pricePeriod: 'semester',
                            capacity: 2,
                            address: 'Block A, North Gate Area, Near FUTA Main Entrance',
                            description: 'Modern hostel with excellent facilities, 24/7 security, and reliable power supply. Perfect for serious students.',
                            amenities: ['WiFi', 'Security', 'Generator', 'Kitchen', 'Study Room'],
                            phone: '08123456789',
                            whatsapp: '08123456789',
                            images: [
                                'https://images.unsplash.com/photo-1555854877-bab0e921b58d?auto=format&fit=crop&w=800&q=80',
                                'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=800&q=80'
                            ],
                            status: 'available',
                            views: 45,
                            inquiries: 8,
                            dateAdded: new Date().toISOString(),
                            lastUpdated: new Date().toISOString(),
                            realtorId: 'admin@mwghostels.com',
                            verified: true,
                            realtorInfo: {
                                fullName: 'Administrator',
                                brandName: 'MWG Premium Properties',
                                email: 'admin@mwghostels.com'
                            }
                        },
                        {
                            id: 'hostel_sample_2',
                            name: 'Comfort Palace',
                            location: 'South Gate',
                            price: 38000,
                            pricePeriod: 'semester',
                            capacity: 3,
                            address: 'House 15, South Gate Road, Akure',
                            description: 'Affordable and comfortable accommodation with all basic amenities. Great for budget-conscious students.',
                            amenities: ['WiFi', 'Security', 'Kitchen', 'Parking'],
                            phone: '08134567890',
                            whatsapp: '08134567890',
                            images: [
                                'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?auto=format&fit=crop&w=800&q=80'
                            ],
                            status: 'available',
                            views: 32,
                            inquiries: 5,
                            dateAdded: new Date().toISOString(),
                            lastUpdated: new Date().toISOString(),
                            realtorId: 'admin@mwghostels.com',
                            verified: true,
                            realtorInfo: {
                                fullName: 'Administrator',
                                brandName: 'MWG Premium Properties',
                                email: 'admin@mwghostels.com'
                            }
                        },
                        {
                            id: 'hostel_sample_3',
                            name: 'Executive Suites',
                            location: 'Main Campus',
                            price: 65000,
                            pricePeriod: 'semester',
                            capacity: 1,
                            address: 'Complex B, Main Campus Area, FUTA',
                            description: 'Luxury accommodation for students who want the best. Private rooms with en-suite bathrooms and premium facilities.',
                            amenities: ['WiFi', 'Security', 'Generator', 'AC', 'Kitchen', 'Study Room', 'Gym'],
                            phone: '08145678901',
                            whatsapp: '08145678901',
                            images: [
                                'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?auto=format&fit=crop&w=800&q=80'
                            ],
                            status: 'available',
                            views: 67,
                            inquiries: 12,
                            dateAdded: new Date().toISOString(),
                            lastUpdated: new Date().toISOString(),
                            realtorId: 'admin@mwghostels.com',
                            verified: true,
                            realtorInfo: {
                                fullName: 'Administrator',
                                brandName: 'MWG Premium Properties',
                                email: 'admin@mwghostels.com'
                            }
                        }
                    ];
                    
                    // Save using sync function
                    if (syncHostelData(sampleHostels)) {
                        console.log('‚úÖ Sample hostels initialized successfully');
                        return true;
                    }
                    return false;
                } catch (error) {
                    console.error('‚ùå Error initializing sample hostels:', error);
                    return false;
                }
            }

            // Check for existing session
            const savedSession = localStorage.getItem('realtorSession');
            if (savedSession) {
                try {
                    realtorState.realtorData = JSON.parse(savedSession);
                    realtorState.isLoggedIn = true;
                    
                    document.getElementById('loginSection').classList.add('hidden');
                    document.getElementById('dashboardSection').classList.remove('hidden');
                    document.getElementById('realtorName').textContent = realtorState.realtorData.name;
                    
                    console.log('üîÑ Restoring session and loading hostels...');
                    
                    // Load hostels with a slight delay to ensure DOM is ready
                    setTimeout(() => {
                        // Initialize sample hostels if needed
                        const initialized = initializeSampleHostels();
                        if (initialized) {
                            console.log('üì¶ Sample hostels added for testing');
                        }
                        
                        loadRealtorHostels();
                        updateDashboardStats();
                        console.log('‚úÖ Session restored, hostels loaded:', realtorState.hostels.length);
                    }, 200);
                    
                } catch (error) {
                    console.error('‚ùå Error restoring session:', error);
                    localStorage.removeItem('realtorSession');
                }
            }
        });
    </script>
    
    <!-- Theme System -->
    <script src="form-enhancements.js"></script>
    <script src="theme-toggle.js"></script>
    
    <script src="realtor-script.js"></script>
</body>
</html>