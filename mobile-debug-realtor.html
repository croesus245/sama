<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Debug - Realtor Login</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            font-size: 12px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #0f0;
        }

        .header h1 {
            color: #0ff;
            margin-bottom: 10px;
        }

        .section {
            background: #111;
            border: 1px solid #0f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .section h2 {
            color: #ff0;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #333;
        }

        .label {
            color: #0ff;
        }

        .value {
            color: #0f0;
            word-break: break-all;
        }

        .error {
            color: #f00 !important;
        }

        .success {
            color: #0f0 !important;
        }

        .warning {
            color: #ff0 !important;
        }

        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            font-size: 14px;
        }

        button:hover {
            background: #0ff;
        }

        .log-entry {
            padding: 5px;
            margin: 5px 0;
            border-left: 3px solid #0f0;
            padding-left: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
        }

        .badge-success {
            background: #0f0;
            color: #000;
        }

        .badge-error {
            background: #f00;
            color: #fff;
        }

        .badge-warning {
            background: #ff0;
            color: #000;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üì± MOBILE REALTOR LOGIN DEBUGGER</h1>
        <p>Real-time diagnostics for mobile authentication issues</p>
        <div style="margin-top: 10px;">
            <span id="connectionStatus" class="status-badge badge-warning">CHECKING...</span>
        </div>
    </div>

    <!-- Device Info -->
    <div class="section">
        <h2>üîç DEVICE INFORMATION</h2>
        <div class="info-row">
            <span class="label">Device Type:</span>
            <span class="value" id="deviceType">-</span>
        </div>
        <div class="info-row">
            <span class="label">User Agent:</span>
            <span class="value" id="userAgent">-</span>
        </div>
        <div class="info-row">
            <span class="label">Screen Size:</span>
            <span class="value" id="screenSize">-</span>
        </div>
        <div class="info-row">
            <span class="label">Viewport:</span>
            <span class="value" id="viewport">-</span>
        </div>
        <div class="info-row">
            <span class="label">Online Status:</span>
            <span class="value" id="onlineStatus">-</span>
        </div>
    </div>

    <!-- API Connection -->
    <div class="section">
        <h2>üåê API CONNECTION TEST</h2>
        <div class="info-row">
            <span class="label">Current URL:</span>
            <span class="value" id="currentUrl">-</span>
        </div>
        <div class="info-row">
            <span class="label">API Base URL:</span>
            <span class="value" id="apiBaseUrl">-</span>
        </div>
        <div class="info-row">
            <span class="label">API Status:</span>
            <span class="value" id="apiStatus">-</span>
        </div>
        <div class="info-row">
            <span class="label">Response Time:</span>
            <span class="value" id="responseTime">-</span>
        </div>
        <button onclick="testApiConnection()">üîÑ TEST API CONNECTION</button>
    </div>

    <!-- Storage Info -->
    <div class="section">
        <h2>üíæ STORAGE INFORMATION</h2>
        <div class="info-row">
            <span class="label">localStorage Available:</span>
            <span class="value" id="localStorageAvailable">-</span>
        </div>
        <div class="info-row">
            <span class="label">sessionStorage Available:</span>
            <span class="value" id="sessionStorageAvailable">-</span>
        </div>
        <div class="info-row">
            <span class="label">realtorToken:</span>
            <span class="value" id="realtorToken">-</span>
        </div>
        <div class="info-row">
            <span class="label">realtorData:</span>
            <span class="value" id="realtorData">-</span>
        </div>
        <div class="info-row">
            <span class="label">validLogin Flag:</span>
            <span class="value" id="validLoginFlag">-</span>
        </div>
        <button onclick="refreshStorage()">üîÑ REFRESH STORAGE</button>
    </div>

    <!-- Login Test -->
    <div class="section">
        <h2>üîê LOGIN TEST</h2>
        <input type="email" id="testEmail" placeholder="Email" style="width: 100%; padding: 10px; margin: 5px 0; background: #000; color: #0f0; border: 1px solid #0f0; border-radius: 5px;">
        <input type="password" id="testPassword" placeholder="Password" style="width: 100%; padding: 10px; margin: 5px 0; background: #000; color: #0f0; border: 1px solid #0f0; border-radius: 5px;">
        <button onclick="testLogin()">üöÄ TEST LOGIN</button>
        <div id="loginTestResult" style="margin-top: 10px;"></div>
    </div>

    <!-- Network Requests -->
    <div class="section">
        <h2>üì° NETWORK REQUESTS LOG</h2>
        <div id="networkLog" style="max-height: 200px; overflow-y: auto;">
            <p style="color: #666;">No requests yet...</p>
        </div>
        <button onclick="clearNetworkLog()">üóëÔ∏è CLEAR LOG</button>
    </div>

    <!-- Console Errors -->
    <div class="section">
        <h2>‚ö†Ô∏è CONSOLE ERRORS</h2>
        <div id="errorLog" style="max-height: 200px; overflow-y: auto;">
            <p style="color: #666;">No errors yet...</p>
        </div>
        <button onclick="clearErrorLog()">üóëÔ∏è CLEAR ERRORS</button>
    </div>

    <!-- Actions -->
    <div class="section">
        <h2>üõ†Ô∏è QUICK ACTIONS</h2>
        <button onclick="clearAllData()">üóëÔ∏è CLEAR ALL DATA</button>
        <button onclick="window.location.href='realtor-login.html'">üîì GO TO LOGIN PAGE</button>
        <button onclick="window.location.href='enhanced-realtor-dashboard.html'">üìä GO TO DASHBOARD</button>
        <button onclick="location.reload()">üîÑ RELOAD PAGE</button>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:5000/api'
            : 'https://mwg-hostels-backend.vercel.app/api';

        let networkRequests = [];
        let errorLogs = [];

        // Initialize
        function init() {
            updateDeviceInfo();
            updateStorageInfo();
            testApiConnection();
            interceptNetworkRequests();
            interceptConsoleErrors();
            setInterval(updateStorageInfo, 2000); // Update storage every 2 seconds
        }

        // Device Information
        function updateDeviceInfo() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            document.getElementById('deviceType').textContent = isMobile ? 'üì± MOBILE' : 'üíª DESKTOP';
            document.getElementById('userAgent').textContent = navigator.userAgent;
            document.getElementById('screenSize').textContent = `${screen.width} x ${screen.height}`;
            document.getElementById('viewport').textContent = `${window.innerWidth} x ${window.innerHeight}`;
            document.getElementById('onlineStatus').textContent = navigator.onLine ? '‚úÖ ONLINE' : '‚ùå OFFLINE';
            document.getElementById('onlineStatus').className = navigator.onLine ? 'value success' : 'value error';
            document.getElementById('currentUrl').textContent = window.location.href;
            document.getElementById('apiBaseUrl').textContent = API_BASE_URL;
        }

        // API Connection Test
        async function testApiConnection() {
            const statusEl = document.getElementById('apiStatus');
            const timeEl = document.getElementById('responseTime');
            const connectionBadge = document.getElementById('connectionStatus');
            
            statusEl.textContent = '‚è≥ TESTING...';
            statusEl.className = 'value warning';
            
            const startTime = Date.now();
            
            try {
                const response = await fetch(`${API_BASE_URL}/realtor-auth/health`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                if (response.ok) {
                    statusEl.textContent = '‚úÖ CONNECTED';
                    statusEl.className = 'value success';
                    connectionBadge.textContent = 'CONNECTED';
                    connectionBadge.className = 'status-badge badge-success';
                    timeEl.textContent = `${responseTime}ms`;
                    timeEl.className = 'value success';
                    logNetwork('GET', '/realtor-auth/health', 'success', responseTime);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusEl.textContent = `‚ùå ${error.message}`;
                statusEl.className = 'value error';
                connectionBadge.textContent = 'ERROR';
                connectionBadge.className = 'status-badge badge-error';
                timeEl.textContent = 'N/A';
                timeEl.className = 'value error';
                logNetwork('GET', '/realtor-auth/health', 'error', 0, error.message);
            }
        }

        // Storage Information
        function updateStorageInfo() {
            try {
                // Test localStorage
                localStorage.setItem('test', '1');
                localStorage.removeItem('test');
                document.getElementById('localStorageAvailable').textContent = '‚úÖ YES';
                document.getElementById('localStorageAvailable').className = 'value success';
            } catch (e) {
                document.getElementById('localStorageAvailable').textContent = `‚ùå NO (${e.message})`;
                document.getElementById('localStorageAvailable').className = 'value error';
            }

            try {
                // Test sessionStorage
                sessionStorage.setItem('test', '1');
                sessionStorage.removeItem('test');
                document.getElementById('sessionStorageAvailable').textContent = '‚úÖ YES';
                document.getElementById('sessionStorageAvailable').className = 'value success';
            } catch (e) {
                document.getElementById('sessionStorageAvailable').textContent = `‚ùå NO (${e.message})`;
                document.getElementById('sessionStorageAvailable').className = 'value error';
            }

            // Check for realtor data
            const token = localStorage.getItem('realtorToken');
            const data = localStorage.getItem('realtorData');
            const validLogin = sessionStorage.getItem('validLogin');

            const tokenEl = document.getElementById('realtorToken');
            if (token) {
                tokenEl.textContent = `‚úÖ ${token.substring(0, 20)}...`;
                tokenEl.className = 'value success';
            } else {
                tokenEl.textContent = '‚ùå NOT FOUND';
                tokenEl.className = 'value error';
            }

            const dataEl = document.getElementById('realtorData');
            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    dataEl.textContent = `‚úÖ ${parsed.name || parsed.email || 'EXISTS'}`;
                    dataEl.className = 'value success';
                } catch (e) {
                    dataEl.textContent = '‚ö†Ô∏è INVALID JSON';
                    dataEl.className = 'value warning';
                }
            } else {
                dataEl.textContent = '‚ùå NOT FOUND';
                dataEl.className = 'value error';
            }

            const validLoginEl = document.getElementById('validLoginFlag');
            if (validLogin === 'true') {
                validLoginEl.textContent = '‚úÖ TRUE';
                validLoginEl.className = 'value success';
            } else {
                validLoginEl.textContent = '‚ùå FALSE';
                validLoginEl.className = 'value error';
            }
        }

        function refreshStorage() {
            updateStorageInfo();
            alert('Storage information refreshed!');
        }

        // Login Test
        async function testLogin() {
            const email = document.getElementById('testEmail').value.trim();
            const password = document.getElementById('testPassword').value;
            const resultDiv = document.getElementById('loginTestResult');

            if (!email || !password) {
                resultDiv.innerHTML = '<p class="error">‚ùå Please enter both email and password</p>';
                return;
            }

            resultDiv.innerHTML = '<p class="warning">‚è≥ Testing login...</p>';

            try {
                const startTime = Date.now();
                const response = await fetch(`${API_BASE_URL}/realtor-auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password, rememberMe: true })
                });

                const endTime = Date.now();
                const responseTime = endTime - startTime;
                const data = await response.json();

                logNetwork('POST', '/realtor-auth/login', response.ok ? 'success' : 'error', responseTime, JSON.stringify(data));

                if (response.ok) {
                    resultDiv.innerHTML = `
                        <p class="success">‚úÖ LOGIN SUCCESSFUL!</p>
                        <p>Response Time: ${responseTime}ms</p>
                        <p>Token: ${data.data.token.substring(0, 20)}...</p>
                        <p>Name: ${data.data.realtor.name}</p>
                        <p>Email: ${data.data.realtor.email}</p>
                    `;

                    // Store the data
                    localStorage.setItem('realtorToken', data.data.token);
                    localStorage.setItem('realtorData', JSON.stringify(data.data.realtor));
                    sessionStorage.setItem('validLogin', 'true');

                    updateStorageInfo();

                    setTimeout(() => {
                        if (confirm('Login successful! Go to dashboard?')) {
                            window.location.href = 'enhanced-realtor-dashboard.html';
                        }
                    }, 1000);
                } else {
                    resultDiv.innerHTML = `
                        <p class="error">‚ùå LOGIN FAILED</p>
                        <p>Status: ${response.status}</p>
                        <p>Message: ${data.message || 'Unknown error'}</p>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">‚ùå REQUEST FAILED</p>
                    <p>Error: ${error.message}</p>
                `;
                logNetwork('POST', '/realtor-auth/login', 'error', 0, error.message);
            }
        }

        // Network Request Logging
        function logNetwork(method, endpoint, status, time, details = '') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = {
                timestamp,
                method,
                endpoint,
                status,
                time,
                details
            };

            networkRequests.unshift(logEntry);
            if (networkRequests.length > 20) networkRequests.pop();

            updateNetworkLog();
        }

        function updateNetworkLog() {
            const logDiv = document.getElementById('networkLog');
            if (networkRequests.length === 0) {
                logDiv.innerHTML = '<p style="color: #666;">No requests yet...</p>';
                return;
            }

            logDiv.innerHTML = networkRequests.map(req => {
                const statusClass = req.status === 'success' ? 'success' : req.status === 'error' ? 'error' : 'warning';
                return `
                    <div class="log-entry">
                        <span class="${statusClass}">[${req.timestamp}]</span>
                        <span class="warning">${req.method}</span>
                        <span>${req.endpoint}</span>
                        ${req.time > 0 ? `<span class="success">(${req.time}ms)</span>` : ''}
                        ${req.details ? `<br><span style="color: #666;">${req.details}</span>` : ''}
                    </div>
                `;
            }).join('');
        }

        function clearNetworkLog() {
            networkRequests = [];
            updateNetworkLog();
        }

        // Error Logging
        function logError(error, source = '') {
            const timestamp = new Date().toLocaleTimeString();
            errorLogs.unshift({ timestamp, error, source });
            if (errorLogs.length > 20) errorLogs.pop();
            updateErrorLog();
        }

        function updateErrorLog() {
            const logDiv = document.getElementById('errorLog');
            if (errorLogs.length === 0) {
                logDiv.innerHTML = '<p style="color: #666;">No errors yet...</p>';
                return;
            }

            logDiv.innerHTML = errorLogs.map(log => `
                <div class="log-entry">
                    <span class="error">[${log.timestamp}]</span>
                    ${log.source ? `<span class="warning">${log.source}:</span>` : ''}
                    <span>${log.error}</span>
                </div>
            `).join('');
        }

        function clearErrorLog() {
            errorLogs = [];
            updateErrorLog();
        }

        // Intercept Network Requests
        function interceptNetworkRequests() {
            const originalFetch = window.fetch;
            window.fetch = function(...args) {
                const startTime = Date.now();
                return originalFetch.apply(this, args)
                    .then(response => {
                        const endTime = Date.now();
                        const url = args[0];
                        const method = args[1]?.method || 'GET';
                        logNetwork(method, url, response.ok ? 'success' : 'error', endTime - startTime);
                        return response;
                    })
                    .catch(error => {
                        const url = args[0];
                        const method = args[1]?.method || 'GET';
                        logNetwork(method, url, 'error', 0, error.message);
                        throw error;
                    });
            };
        }

        // Intercept Console Errors
        function interceptConsoleErrors() {
            window.addEventListener('error', (e) => {
                logError(e.message, e.filename);
            });

            window.addEventListener('unhandledrejection', (e) => {
                logError(e.reason, 'Promise');
            });

            const originalError = console.error;
            console.error = function(...args) {
                logError(args.join(' '), 'console.error');
                originalError.apply(console, args);
            };
        }

        // Clear All Data
        function clearAllData() {
            if (confirm('This will clear all stored data. Continue?')) {
                localStorage.clear();
                sessionStorage.clear();
                updateStorageInfo();
                alert('All data cleared!');
            }
        }

        // Online/Offline Detection
        window.addEventListener('online', () => {
            updateDeviceInfo();
            testApiConnection();
        });

        window.addEventListener('offline', () => {
            updateDeviceInfo();
        });

        // Initialize on load
        init();
    </script>
</body>
</html>
